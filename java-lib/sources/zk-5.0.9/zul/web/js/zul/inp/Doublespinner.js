(function(){function b(d,f){var g=""+d,e=g.indexOf(f);return e<0?0:g.length-e-1}function a(i,h,g,e){var f;if(g){f=Math.pow(10,g);i*=f;h*=f;i=Math.round(i);h=Math.round(h)}var d=e?i+h:i-h;if(g){d/=f}return d}function c(h,g){var e=h._localizedSymbols?h._localizedSymbols.DECIMAL:zk.DECIMAL,f=b(h._step,e),d=b(g||h._value,e);h._fixedDigits=Math.max(f,d)}zul.inp.Doublespinner=zk.$extends(zul.inp.NumberInputWidget,{_value:0,_step:1,_buttonVisible:true,$define:{step:function(d){c(this)},buttonVisible:function(d){var g=this.$n("btn"),e=this.getZclass();if(!g){return}if(!this.inRoundedMold()){if(!this._inplace||!d){jq(g)[d?"show":"hide"]()}else{g.style.display=""}jq(this.getInputNode())[d?"removeClass":"addClass"](e+"-right-edge")}else{var f=d?"removeClass":"addClass";jq(g)[f](e+"-btn-right-edge");if(zk.ie6_){jq(g)[f](e+(this._readonly?"-btn-right-edge-readonly":"-btn-right-edge"));if(jq(this.getInputNode()).hasClass(e+"-text-invalid")){jq(g)[f](e+"-btn-right-edge-invalid")}}}this.onSize();return}},getZclass:function(){var d=this._zclass;return d!=null?d:"z-doublespinner"+(this.inRoundedMold()?"-rounded":"")},isButtonVisible:function(){return _buttonVisible},doubleValue:function(){return this.$supers("getValue",arguments)},setConstraint:function(d){if(typeof d=="string"&&d.charAt(0)!="["){var e=new zul.inp.SimpleDoubleSpinnerConstraint(d);this._min=e._min;this._max=e._max;this.$supers("setConstraint",[e])}else{this.$supers("setConstraint",arguments)}},coerceFromString_:function(l){if(!l){return null}var f=zk.fmt.Number.unformat(this._format,l,false,this._localizedSymbols),m=f.raw,e=parseFloat(m),g=""+e,k=g.indexOf("."),i=m.indexOf(".");if(isNaN(e)||g.indexOf("e")<0){if(i==0){m="0"+m;++i}if(i>=0&&m.substring(m.substring(i+1))&&k<0){k=g.length;g+="."}var h=m.length,d=g.length;if(k>=0&&k<i){d-=k;h-=i;for(var j=i-k;j-->0;){g="0"+g}}if(d<h){for(var j=h-d;j-->0;){g+="0"}}if(isNaN(e)||(m!=g&&m!="-"+g&&m.indexOf("e")<0)){return{error:zk.fmt.Text.format(msgzul.NUMBER_REQUIRED,l)}}}if(f.divscale){e=e/Math.pow(10,f.divscale)}c(this,e);return e},coerceToString_:function(e){var d=this._format,f=this._localizedSymbols?this._localizedSymbols.DECIMAL:zk.DECIMAL;return e==null?"":d?zk.fmt.Number.format(d,e,this._rounding,this._localizedSymbols):f=="."?(""+e):(""+e).replace(".",f)},onSize:function(){var d=this.getWidth();if(!d||d.indexOf("%")!=-1){this.getInputNode().style.width=""}this.syncWidth()},onHide:zul.inp.Textbox.onHide,validate:zul.inp.Doublebox.validate,doKeyDown_:function(d){var e=this.inp;if(e.disabled||e.readOnly){return}switch(d.keyCode){case 38:this.checkValue();this._increase(true);d.stop();return;case 40:this.checkValue();this._increase(false);d.stop();return}this.$supers("doKeyDown_",arguments)},_ondropbtnup:function(d){var e=this.getZclass();jq(this._currentbtn).removeClass(e+"-btn-clk");if(!this.inRoundedMold()){jq(this._currentbtn).removeClass(e+"-btn-up-clk");jq(this._currentbtn).removeClass(e+"-btn-down-clk")}this.domUnlisten_(document.body,"onZMouseUp","_ondropbtnup");this._currentbtn=null},_btnDown:function(e){var g=this.inRoundedMold();if(g&&!this._buttonVisible){return}var h;if(!(h=this.inp)||h.disabled){return}var f=this.$n("btn"),k=this.getZclass();if(!zk.dragging){if(this._currentbtn){this.ondropbtnup(e)}jq(f).addClass(k+"-btn-clk");this.domListen_(document.body,"onZMouseUp","_ondropbtnup");this._currentbtn=f}this.checkValue();var i=zk(f).revisedOffset(),d=(e.pageY-i[1])<f.offsetHeight/2;if(d){this._increase(true);this._startAutoIncProc(true)}else{this._increase(false);this._startAutoIncProc(false)}var j=g?"":d?"-up":"-down";if((f=this.$n("btn"+j))&&!g){jq(f).addClass(k+"-btn"+j+"-clk");this._currentbtn=f}e.stop()},checkValue:function(){var f=this.inp,e=this._min,d=this._max;if(!f.value){if(e&&d){f.value=(e<=0&&0<=d)?0:e}else{if(e){f.value=e<=0?0:e}else{if(d){f.value=0<=d?0:d}else{f.value=0}}}}},_btnUp:function(e){if(this.inRoundedMold()&&!this._buttonVisible){return}var f=this.inp;if(f.disabled){return}this._onChanging();this._stopAutoIncProc();if(zk.ie){var d=f.value.length;zk(f).setSelectionRange(d,d)}f.focus()},_btnOut:function(d){if(this.inRoundedMold()&&!this._buttonVisible){return}if(this.inp&&!this.inp.disabled&&!zk.dragging){jq(this.$n("btn")).removeClass(this.getZclass()+"-btn-over")}var e=this.inp;if(e.disabled){return}this._stopAutoIncProc()},_btnOver:function(d){if(this.inRoundedMold()&&!this._buttonVisible){return}if(this.inp&&!this.inp.disabled&&!zk.dragging){jq(this.$n("btn")).addClass(this.getZclass()+"-btn-over")}},_increase:function(g){var f=this.inp,h=this.coerceFromString_(f.value),e=Math.max(b(h),this._fixedDigits),d=a(h,this._step,e,g);if(d>Math.pow(2,63)-1){d=Math.pow(2,63)-1}else{if(d<-Math.pow(2,63)){d=-Math.pow(2,63)}}if(this._max!=null&&d>this._max){d=h}else{if(this._min!=null&&d<this._min){d=h}}f.value=this.coerceToString_(d);this._onChanging()},_clearValue:function(){var d=this.inp;d.value=this._defValue="";return true},_startAutoIncProc:function(d){var e=this;if(this.timerId){clearInterval(this.timerId)}this.timerId=setInterval(function(){e._increase(d)},200)},_stopAutoIncProc:function(){if(this.timerId){clearTimeout(this.timerId)}this.timerId=null},syncWidth:function(){zul.inp.RoundUtl.syncWidth(this,this.$n("btn"))},doFocus_:function(d){var e=this.$n();if(this._inplace){e.style.width=jq.px0(zk(e).revisedWidth(e.offsetWidth))}this.$supers("doFocus_",arguments);if(this._inplace){if(jq(e).hasClass(this.getInplaceCSS())){jq(e).removeClass(this.getInplaceCSS());this.onSize()}}},doBlur_:function(d){var e=this.$n();if(this._inplace&&this._inplaceout){e.style.width=jq.px0(zk(e).revisedWidth(e.offsetWidth))}this.$supers("doBlur_",arguments);if(this._inplace&&this._inplaceout){jq(e).addClass(this.getInplaceCSS());this.onSize();e.style.width=this.getWidth()||""}},afterKeyDown_:function(d,e){if(!e&&this._inplace){jq(this.$n()).toggleClass(this.getInplaceCSS(),d.keyCode==13?null:false)}return this.$supers("afterKeyDown_",arguments)},getAllowedKeys_:function(){var d=this._localizedSymbols;return this.$supers("getAllowedKeys_",arguments)+(d?d:zk).DECIMAL+"e"},bind_:function(){this.$supers(zul.inp.Doublespinner,"bind_",arguments);this.timeId=null;var e=this.inp=this.$n("real"),d;if(this._inplace){jq(e).addClass(this.getInplaceCSS())}if(d=this.$n("btn")){this.domListen_(d,"onZMouseDown","_btnDown").domListen_(d,"onZMouseUp","_btnUp").domListen_(d,"onMouseOut","_btnOut").domListen_(d,"onMouseOver","_btnOver")}zWatch.listen({onSize:this})},unbind_:function(){if(this.timerId){clearTimeout(this.timerId);this.timerId=null}zWatch.unlisten({onSize:this});var d=this.$n("btn");if(d){this.domUnlisten_(d,"onZMouseDown","_btnDown").domUnlisten_(d,"onZMouseUp","_btnUp").domUnlisten_(d,"onMouseOut","_btnOut").domUnlisten_(d,"onMouseOver","_btnOver")}this.$supers(zul.inp.Doublespinner,"unbind_",arguments)}})})();