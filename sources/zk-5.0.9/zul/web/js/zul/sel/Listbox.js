(function(){function b(d){return zk.isLoaded("zkex.sel")&&d.$instanceof(zkex.sel.Listgroup)}function a(d){if(d&&(d=d.frozen)){d._syncFrozen()}}var c=zul.sel.Listbox=zk.$extends(zul.sel.SelectWidget,{_nrows:0,groupSelect:false,$define:{emptyMessage:function(d){if(this.desktop){jq("td",this.$n("empty")).html(d)}}},$init:function(){this.$supers("$init",arguments);this._groupsInfo=[]},getGroupCount:function(){return this._groupsInfo.length},getGroups:function(){return this._groupsInfo.$clone()},hasGroup:function(){return this._groupsInfo.length},nextItem:function(d){if(d){while((d=d.nextSibling)&&!d.$instanceof(zul.sel.Listitem)){}}return d},previousItem:function(d){if(d){while((d=d.previousSibling)&&!d.$instanceof(zul.sel.Listitem)){}}return d},getOddRowSclass:function(){return this._scOddRow==null?this.getZclass()+"-odd":this._scOddRow},setOddRowSclass:function(d){if(!d){d=null}if(this._scOddRow!=d){this._scOddRow=d;var e=this.$n();if(e&&this.rows){this.stripe()}}return this},inSelectMold:function(){return"select"==this.getMold()},onSize:function(){this.$supers("onSize",arguments);this._syncSelInView()},bind_:function(g,f,e){this.$supers(c,"bind_",arguments);this._shallStripe=true;var d=this;e.push(zk.booted?function(){setTimeout(function(){d.onResponse()},0)}:this.proxy(this.stripe));e.push(function(){a(d)});this._shallScrollIntoView=true;if(zk.ie6_&&this.getSelectedIndex()>-1){zk(this).redoCSS()}},_syncSelInView:function(){if(this._shallScrollIntoView){var e=this.getSelectedIndex();if(e>=0){var d;for(var f=this.getBodyWidgetIterator();e-->=0;){d=f.next()}if(d){zk(d).scrollIntoView(this.ebody);this._tmpScrollTop=this.ebody.scrollTop}}this._shallScrollIntoView=false}},_doScroll:function(){if(this._tmpScrollTop){this.ebody.scrollTop=this._tmpScrollTop;this._tmpScrollTop=null}this.$super(zul.sel.Listbox,"_doScroll")},onResponse:function(){if(this.desktop){if(this._shallStripe){this.stripe()}if(this._shallFixEmpty){this._fixForEmpty()}}this.$supers("onResponse",arguments)},_syncStripe:function(){this._shallStripe=true},stripe:function(){var d=this.getOddRowSclass();if(!d){return}var h=this._offset&1;for(var f=0,i=!h,g=this.getBodyWidgetIterator(),e;(e=g.next());f++){if(e.isVisible()&&e.isStripeable_()){jq(e.$n())[i?"removeClass":"addClass"](d);i=!i}}this._shallStripe=false;return this},rerender:function(){this.$supers("rerender",arguments);this._syncStripe();return this},getFocusCell:function(h){var e=this.getCaveNode();if(jq.isAncestor(e,h)){var g=jq(h).parents("td"),k;for(var f=0,d=g.length;f<d;f++){k=g[f];if(k.parentNode.parentNode==e){return k}}}},getCaveNode:function(){return this.$n("rows")||this.$n("cave")},insertChildHTML_:function(f,d,e){if(d=d&&(!f.$instanceof(zul.sel.Listitem)||d.$instanceof(zul.sel.Listitem))?d.getFirstNode_():null){jq(d).before(f.redrawHTML_())}else{jq(this.getCaveNode()).append(f.redrawHTML_())}f.bind(e)},getZclass:function(){return this._zclass==null?"z-listbox":this._zclass},insertBefore:function(f,e,d){if(this.$super("insertBefore",f,e,d||(!this.z_rod&&!f.$instanceof(zul.sel.Listitem)))){this._fixOnAdd(f,d);return true}},appendChild:function(e,d){if(this.$super("appendChild",e,d||(!this.z_rod&&!e.$instanceof(zul.sel.Listitem)))){if(!this.insertingBefore_){this._fixOnAdd(e,d)}return true}},_fixOnAdd:function(h,e,f,d){var g;if(h.$instanceof(zul.sel.Listitem)){if(b(h)){this._groupsInfo.push(h)}if(!this.firstItem||!this.previousItem(h)){this.firstItem=h}if(!this.lastItem||!this.nextItem(h)){this.lastItem=h}++this._nrows;if(h.isSelected()&&!this._selItems.$contains(h)){this._selItems.push(h)}g=f=true}else{if(h.$instanceof(zul.sel.Listhead)){this.listhead=h}else{if(h.$instanceof(zul.mesh.Paging)){this.paging=h}else{if(h.$instanceof(zul.sel.Listfoot)){this.listfoot=h}else{if(h.$instanceof(zul.mesh.Frozen)){this.frozen=h}}}}}this._syncEmpty();if(!d){if(!e&&!g){return this.rerender()}if(f){this._syncStripe()}if(!e){this._syncSize()}if(this.desktop){a(this)}}},removeChild:function(e,d){if(this.$super("removeChild",e,d)){this._fixOnRemove(e,d);return true}},_fixOnRemove:function(h,d){var f;if(h==this.listhead){this.listhead=null}else{if(h==this.paging){this.paging=null}else{if(h==this.frozen){this.frozen=null}else{if(h==this.listfoot){this.listfoot=null}else{if(!h.$instanceof(zul.mesh.Auxhead)){if(h==this.firstItem){for(var e=this.firstChild,g=zul.sel.Listitem;e&&!e.$instanceof(g);e=e.nextSibling){}this.firstItem=e}if(h==this.lastItem){for(var e=this.lastChild,g=zul.sel.Listitem;e&&!e.$instanceof(g);e=e.previousSibling){}this.lastItem=e}if(b(h)){this._groupsInfo.$remove(h)}--this._nrows;if(h.isSelected()){this._selItems.$remove(h)}f=true}}}}}this._syncEmpty();if(!d){if(f){this._syncStripe()}this._syncSize()}},redrawEmpty_:function(d){var f=(this.listhead&&this.listhead.nChildren)||1,e=this.uuid,g=this.getZclass();d.push('<tbody id="',e,'-empty" class="',g,'-empty-body" ',((!this._emptyMessage||this._nrows)?' style="display:none"':""),'><tr><td colspan="',f,'">',this._emptyMessage,"</td></tr></tbody>")},_syncEmpty:function(){this._shallFixEmpty=true},_fixForEmpty:function(){if(this.desktop){if(this._nrows){jq(this.$n("empty")).hide()}else{jq(this.$n("empty")).show()}}},onChildReplaced_:function(d,e){this.$supers("onChildReplaced_",arguments);if(d){this._fixOnRemove(d,true)}if(e){this._fixOnAdd(e,true,false,true)}if((d&&d.$instanceof(zul.sel.Listitem))||(e&&e.$instanceof(zul.sel.Listitem))){this._syncStripe()}this._syncSize();if(this.desktop){a(this)}},getHeadWidgetClass:function(){return zul.sel.Listhead},itemIterator:_zkf=function(d){return new zul.sel.ItemIter(this,d)},getBodyWidgetIterator:_zkf,_updHeaderCM:function(){var d;if(this._headercm&&this._multiple&&(d=this.listhead)&&(d=d.firstChild)){d._checked=this._isAllSelected()}this.$supers("_updHeaderCM",arguments)}});zul.sel.ItemIter=zk.$extends(zk.Object,{$init:function(e,d){this.box=e;this.opts=d},_init:function(){if(!this._isInit){this._isInit=true;var d=this.box.firstItem;if(this.opts&&this.opts.skipHidden){for(;d&&!d.isVisible();d=d.nextSibling){}}this.p=d}},hasNext:function(){this._init();return this.p},next:function(){this._init();var e=this.p,d=e?e.parent.nextItem(e):null;if(this.opts&&this.opts.skipHidden){for(;d&&!d.isVisible();d=d.parent.nextItem(d)){}}if(e){this.p=d}return e}})})();