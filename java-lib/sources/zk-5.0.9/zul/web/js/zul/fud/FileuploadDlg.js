zul.fud.FileuploadDlg=zk.$extends(zul.wnd.Window,{cancel:function(b){var a=this.$f("fileupload");if(a){a._uplder.destroy();if(b){zAu.send(new zk.Event(this,"onClose"));this.detach()}}},submit:function(){this.cancel();zAu.send(new zk.Event(this,"onClose",true));this.detach()}});zul.fud.ModalFileViewer=zk.$extends(zk.Object,{updated:null,$init:function(e,h){this._uplder=e;h=h.replace(/\//g,"\\");h=h.substring(h.lastIndexOf("\\")+1,h.length);var a=e.id,g=this,i=e.getWidget(),b=i.$f("uploaded"),f=i.$o().max||0,c=zk.ajaxURI("/web/zk/img/progress2.gif",{au:true}),d='<div id="'+a+'" style="min-height:16px;background:#F4F8FF;border: 1px solid #99AABD;font-family:arial,sans-serif;font-size: 11px;padding: 2px;color: #0F3B82;"><image style="float: left;" src="'+c+'"/><div id="'+a+'-cnt"><a id="'+a+'-cancel" style="float: left;padding-left: 2px; color: #0366AC; font-weight: bold;cursor: pointer;">'+msgzul.UPLOAD_CANCEL+" </a>&nbsp;&nbsp;&nbsp;"+h+'</div><div style="padding-left: 24px">'+msgzk.FILE_SIZE+'&nbsp;&nbsp;<span id="'+a+'-sent">0</span> of <span id="'+a+'-total">0</span></div></div>';b.setVisible(true);jq(b).append(d);if(f>0&&f<=b.$n().childNodes.length){b.$f("fileupload").setVisible(false)}this.viewer=jq("#"+a)[0];jq("#"+a+"-cancel").click(function(){i.$f("submit").revert();if(!g._finish){e.cancel()}else{var k=jq("#"+a),j=k.parent().children().index(k[0]);zAu.send(new zk.Event(i.$o(),"onRemove",j));jq(g.viewer).remove()}if(f>0&&f>b.$n().childNodes.length){b.$f("fileupload").setVisible(true)}})},update:function(a,b){jq("#"+this._uplder.id+"-sent").html(Math.round((b/1024)*a/100)+msgzk.KBYTES);if(!this.updated){this.updated=true;jq("#"+this._uplder.id+"-total").html(Math.round(b/1024)+msgzk.KBYTES)}},destroy:function(a){if(this._finish){return}this._finish=a;if(!a){jq(this.viewer).remove()}else{jq("#"+this._uplder.id+"-sent").parent().remove();jq("#"+this._uplder.id)[0].firstChild.src=zk.ajaxURI("/web/zk/img/attachment.gif",{au:true})}}});