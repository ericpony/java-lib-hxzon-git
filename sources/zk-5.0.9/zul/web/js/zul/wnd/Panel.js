zul.wnd.Panel=zk.$extends(zul.Widget,{_border:"none",_title:"",_open:true,_minheight:100,_minwidth:200,$init:function(){this.$supers("$init",arguments);this.listen({onMaximize:this,onClose:this,onMove:this,onSize:this.onSizeEvent},-1000);this._skipper=new zul.wnd.PanelSkipper(this)},$define:{minheight:null,minwidth:null,sizable:function(a){if(this.desktop){if(a){this._makeSizer()}else{if(this._sizer){this._sizer.destroy();this._sizer=null}}}},movable:_zkf=function(){this.rerender(this._skipper)},floatable:_zkf,maximizable:_zkf,minimizable:_zkf,collapsible:_zkf,closable:_zkf,border:function(){this.rerender()},title:function(){if(this.caption){this.caption.updateDomContent_()}else{this.rerender(this._skipper)}},open:function(b,a){var c=this.$n();if(c){var e=this.getZclass(),d=jq(this.$n("body"));if(d[0]&&!d.is(":animated")){if(b){jq(c).removeClass(e+"-colpsd");d.zk.slideDown(this)}else{jq(c).addClass(e+"-colpsd");this._hideShadow();if(zk.ie6_&&!c.style.width){c.runtimeStyle.width="100%"}d.zk.slideUp(this)}if(!a){this.fire("onOpen",{open:b})}}}},maximized:function(c,k){var r=this.$n();if(r){var z=zk(r),B=z.isRealVisible();if(!B&&c){return}var u,i,f,x,j=r.style,b=this.getZclass();if(c){jq(this.$n("max")).addClass(b+"-maxd");this._hideShadow();if(this._collapsible&&!this._open){z.jq.removeClass(b+"-colpsd");var g=this.$n("body");if(g){g.style.display=""}}var a=this.isFloatable(),e=a?jq(r).offsetParent():jq(r).parent();var A=zk.ie6_&&e[0].clientHeight==0?e[0].offsetHeight-e.zk.borderHeight():e[0].clientHeight;if(zk.isLoaded("zkmax.layout")&&this.parent.$instanceof(zkmax.layout.Portalchildren)){var y=this.parent.parent;if(y.getMaximizedMode()=="whole"){this._inWholeMode=true;var o=y.$n(),q=o.style;A=zk.ie6_&&o.clientHeight==0?o.offsetHeight-jq(o).zk.borderHeight():o.clientHeight;var n=this._oldNodeInfo={_scrollTop:o.parentNode.scrollTop};o.parentNode.scrollTop=0;z.makeVParent();zWatch.fireDown("onVParent",this);n._pos=j.position;n._ppos=q.position;n._zIndex=j.zIndex;j.position="absolute";this.setFloating_(true);this.setTopmost();o.appendChild(r);q.position="relative";if(!q.height){q.height=jq.px0(A);n._pheight=true}if(zk.ie7_){zk(r).redoCSS()}}}var a=this.isFloatable(),e=a?jq(r).offsetParent():jq(r).parent();u=j.left;i=j.top;f=j.width;x=j.height;j.top="-10000px";j.left="-10000px";var m=zk.ie6_&&e[0].clientWidth==0?e[0].offsetWidth-e.zk.borderWidth():e[0].clientWidth;if(!a){m-=e.zk.paddingWidth();m=z.revisedWidth(m);A-=e.zk.paddingHeight();A=z.revisedHeight(A)}j.width=jq.px0(m);j.height=jq.px0(A);this._lastSize={l:u,t:i,w:f,h:x};j.top="0";j.left="0";f=j.width;x=j.height}else{var v=this.$n("max"),d=jq(v);d.removeClass(b+"-maxd").removeClass(b+"-maxd-over");if(this._lastSize){j.left=this._lastSize.l;j.top=this._lastSize.t;j.width=this._lastSize.w;j.height=this._lastSize.h;this._lastSize=null}u=j.left;i=j.top;f=j.width;x=j.height;if(this._collapsible&&!this._open){jq(r).addClass(b+"-colpsd");var g=this.$n("body");if(g){g.style.display="none"}}var g=this.panelchildren?this.panelchildren.$n():null;if(g){g.style.width=g.style.height=""}if(this._inWholeMode){z.undoVParent();zWatch.fireDown("onVParent",this);var n=this._oldNodeInfo;r.style.position=n?n._pos:"";this.setZIndex((n?n._zIndex:""),{fire:true});this.setFloating_(false);var o=this.parent.parent.$n();o.style.position=n?n._ppos:"";o.parentNode.scrollTop=n?n._scrollTop:0;if(n&&n._pheight){o.style.height=""}this._oldNodeInfo=null;this._inWholeMode=false}}if(!k&&B){this._visible=true;this.fire("onMaximize",{left:u,top:i,width:f,height:x,maximized:c,fromServer:k})}if(B){zUtl.fireSized(this)}}},minimized:function(d,c){if(this._maximized){this.setMaximized(false)}var i=this.$n();if(i){var g=i.style,b=g.left,e=g.top,a=g.width,f=g.height;if(d){zWatch.fireDown("onHide",this);jq(i).hide()}else{jq(i).show();zUtl.fireShown(this)}if(!c){this._visible=false;this.fire("onMinimize",{left:g.left,top:g.top,width:g.width,height:g.height,minimized:d})}}},tbar:function(a){this.tbar=zk.Widget.$(a);if(this.bbar==this.tbar){this.bbar=null}if(this.fbar==this.tbar){this.fbar=null}this.rerender()},bbar:function(a){this.bbar=zk.Widget.$(a);if(this.tbar==this.bbar){this.tbar=null}if(this.fbar==this.bbar){this.fbar=null}this.rerender()},fbar:function(a){this.fbar=zk.Widget.$(a);if(this.tbar==this.fbar){this.tbar=null}if(this.bbar==this.fbar){this.bbar=null}this.rerender()}},setVisible:function(a){if(this._visible!=a){if(this._maximized){this.setMaximized(false)}else{if(this._minimized){this.setMinimized(false)}}this.$supers("setVisible",arguments)}},setHeight:function(){this.$supers("setHeight",arguments);if(this.desktop){zUtl.fireSized(this)}},setWidth:function(){this.$supers("setWidth",arguments);if(this.desktop){zUtl.fireSized(this)}},setTop:function(){this._hideShadow();this.$supers("setTop",arguments);this.zsync()},setLeft:function(){this._hideShadow();this.$supers("setLeft",arguments);this.zsync()},updateDomStyle_:function(){this.$supers("updateDomStyle_",arguments);if(this.desktop){zUtl.fireSized(this)}},addToolbar:function(a,b){switch(a){case"tbar":this.tbar=b;break;case"bbar":this.bbar=b;break;case"fbar":this.fbar=b;break;default:return false}return this.appendChild(b)},onClose:function(){if(!this.inServer||!this.isListen("onClose",{asapOnly:1})){this.parent.removeChild(this)}},onMove:function(a){this._left=a.left;this._top=a.top},onMaximize:function(a){var b=a.data;this._top=b.top;this._left=b.left;this._height=b.height;this._width=b.width},onSizeEvent:function(a){var e=a.data,d=this.$n(),c=d.style;this._hideShadow();if(e.width!=c.width){c.width=e.width}if(e.height!=c.height){c.height=e.height;this._fixHgh()}if(e.left!=c.left||e.top!=c.top){c.left=e.left;c.top=e.top;this.fire("onMove",zk.copy({left:d.style.left,top:d.style.top},a.data),{ignorable:true})}this.zsync();var b=this;setTimeout(function(){zUtl.fireSized(b)},zk.ie6_?800:0)},setFlexSizeH_:function(d,b,a,c){if(c){a+=this._titleHeight(d)+(this._rounded()?jq(this.$n("body")).find(":last")[0].offsetHeight:0)}this.$supers("setFlexSizeH_",arguments)},beforeSize:function(){if(this._maximized){this.$n().style.width=""}if(!this._flexListened){this.$n("body").style.width=""}},resetSize_:function(a){this.$supers(zul.wnd.Panel,"resetSize_",arguments);(this.$n("body")).style[a=="w"?"width":"height"]=""},onSize:(function(){function a(i){if(!i._lastSize){return}var f=i.$n(),e=zk(f),g=i.isFloatable(),h=g?jq(f).offsetParent():jq(f).parent(),d=f.style;var b=zk.ie6_&&h[0].clientWidth==0?h[0].offsetWidth-h.zk.borderWidth():h[0].clientWidth;if(!g){b-=h.zk.paddingWidth();b=e.revisedWidth(b)}d.width=jq.px0(b);if(i._open){var c=zk.ie6_&&h[0].clientHeight==0?h[0].offsetHeight-h.zk.borderHeight():h[0].clientHeight;if(!g){c-=h.zk.paddingHeight();c=e.revisedHeight(c)}d.height=jq.px0(c)}}return function(b){this._hideShadow();if(this._maximized){a(this)}if(this.tbar){b.fireDown(this.tbar)}if(this.bbar){b.fireDown(this.bbar)}if(this.fbar){b.fireDown(this.fbar)}this._syncBodyWidth();this._fixHgh();this.zsync()}})(),onHide:function(){this._hideShadow()},_syncBodyWidth:zk.ie6_?function(){this.$n("body").style.width=this.$n().offsetWidth}:zk.$void,_fixHgh:function(){var b;if(!(b=this.panelchildren)||b.z_rod||!this.isRealVisible()){return}var d=this.$n(),a=b.$n(),c=d.style.height;if(c&&c!="auto"){zk(a).setOffsetHeight(this._offsetHeight(d))}if(zk.ie6_){zk(a).redoCSS()}},_rounded:_zkf=function(){return this._border.startsWith("rounded")},isFramable:_zkf,_bordered:function(){var a;return(a=this._border)!="none"&&a!="rounded"},_offsetHeight:function(i){var c=i.offsetHeight-this._titleHeight(i);if(this._rounded()){var a=this.panelchildren.$n(),g=jq(this.$n("body")).find(":last")[0],f=this.$n("cap");c-=g.offsetHeight;if(a){c-=zk(a.parentNode).padBorderHeight()}if(f){c-=zk(f.parentNode).padBorderHeight()}}c-=zk(i).padBorderHeight();var b=this.$n("tb"),e=this.$n("bb"),d=this.$n("fb");if(b){c-=b.offsetHeight}if(e){c-=e.offsetHeight}if(d){c-=d.offsetHeight}return c},_titleHeight:function(d){var a=this._rounded(),b=this.$n("cap"),c=a?jq(d).find("> div:first-child")[0].offsetHeight:0;return b?(a?jq(d).find("> div:first-child").next()[0]:b).offsetHeight+c:c},onFloatUp:function(a){if(!this._visible||!this.isFloatable()){return}for(var b=a.origin;b;b=b.parent){if(b==this){this.setTopmost();return}if(b.isFloating_()){return}}},getZclass:function(){return this._zclass==null?"z-panel":this._zclass},_makeSizer:function(){if(!this._sizer){this.domListen_(this.$n(),"onMouseMove");this.domListen_(this.$n(),"onMouseOut");var a=this.$class;this._sizer=new zk.Draggable(this,null,{stackup:true,draw:a._drawsizing,snap:a._snapsizing,starteffect:a._startsizing,ghosting:a._ghostsizing,endghosting:a._endghostsizing,ignoredrag:a._ignoresizing,endeffect:a._aftersizing})}},_initFloat:function(){var b=this.$n();if(!b.style.top||!b.style.left){var a=zk(b).revisedOffset();b.style.left=jq.px(a[0]);b.style.top=jq.px(a[1])}b.style.position="absolute";if(this.isMovable()){this._initMove()}this.zsync();if(this.isRealVisible()){this.setTopmost()}},_initMove:function(b){var c=this.$n("cap");if(c&&!this._drag){jq(c).addClass(this.getZclass()+"-header-move");var a=this.$class;this._drag=new zk.Draggable(this,null,{handle:c,stackup:true,starteffect:a._startmove,ignoredrag:a._ignoremove,endeffect:a._aftermove})}},zsync:function(){this.$supers("zsync",arguments);if(!this.isFloatable()){if(this._shadow){this._shadow.destroy();this._shadow=null}}else{var a=this.$n("body");if(a&&zk(a).isRealVisible()){if(!this._shadow){this._shadow=new zk.eff.Shadow(this.$n(),{left:-4,right:4,top:-2,bottom:3})}if(this._maximized||this._minimized||!this._visible){this._hideShadow()}else{this._shadow.sync()}}}},_hideShadow:function(){var a=this._shadow;if(a){a.hide()}},bind_:function(f,e,d){this.$supers(zul.wnd.Panel,"bind_",arguments);zWatch.listen({onSize:this,onHide:this});if(zk.ie6_){zWatch.listen({beforeSize:this})}else{if(zk.ie7_){zk(this.$n()).redoCSS()}}var c=this.uuid,b=this.$class;if(this._sizable){this._makeSizer()}if(this.isFloatable()){zWatch.listen({onFloatUp:this});this.setFloating_(true);this._initFloat();if(!zk.css3){jq.onzsync(this)}}if(this._maximizable&&this._maximized){var a=this;d.push(function(){a._maximized=false;a.setMaximized(true,true)})}},unbind_:function(){if(this._inWholeMode){var b=this.$n(),a;zk(b).undoVParent();var c=this.parent;if(c&&(c=c.parent)&&(c=c.$n())&&(a=this._oldNodeInfo)){c.style.position=a._ppos;c.parentNode.scrollTop=a._scrollTop}this._inWholeMode=false}zWatch.unlisten({onSize:this,onHide:this,onFloatUp:this});if(zk.ie6_){zWatch.unlisten({beforeSize:this})}this.setFloating_(false);if(!zk.css3){jq.unzsync(this)}if(this._shadow){this._shadow.destroy();this._shadow=null}if(this._drag){this._drag.destroy();this._drag=null}this.domUnlisten_(this.$n(),"onMouseMove");this.domUnlisten_(this.$n(),"onMouseOut");this.$supers(zul.wnd.Panel,"unbind_",arguments)},_doMouseMove:function(a){if(this._sizer&&(a.target==this||a.target==this.panelchildren)){var f=this.$n(),e=this.$class._insizer(f,zk(f).revisedOffset(),a.pageX,a.pageY),b=this.isMovable()?this.$n("cap"):false,d=this.getZclass();if(!this._maximized&&this._open&&e){if(this._backupCursor==undefined){this._backupCursor=f.style.cursor}f.style.cursor=e==1?"n-resize":e==2?"ne-resize":e==3?"e-resize":e==4?"se-resize":e==5?"s-resize":e==6?"sw-resize":e==7?"w-resize":"nw-resize";if(b){jq(b).removeClass(d+"-header-move")}}else{f.style.cursor=this._backupCursor||"";if(b){jq(b).addClass(d+"-header-move")}}}},_doMouseOut:function(a){this.$n().style.cursor=this._backupCursor||""},doClick_:function(b){var d=this.$n("max"),e=this.$n("min"),f=this.getZclass();switch(b.domTarget){case this.$n("close"):this.fire("onClose");break;case d:this.setMaximized(!this._maximized);jq(d).removeClass(f+"-max-over");break;case e:this.setMinimized(!this._minimized);jq(e).removeClass(f+"-min-over");break;case this.$n("exp"):var a=this.$n("body"),c=a?zk(a).isVisible():this._open;if(!c==this._open){this._open=c}this.setOpen(!c);break;default:this.$supers("doClick_",arguments);return}b.stop()},doMouseOver_:function(a){var c=this.getZclass();switch(a.domTarget){case this.$n("close"):jq(this.$n("close")).addClass(c+"-close-over");break;case this.$n("max"):var b=this._maximized?" "+c+"-maxd-over":"";jq(this.$n("max")).addClass(c+"-max-over"+b);break;case this.$n("min"):jq(this.$n("min")).addClass(c+"-min-over");break;case this.$n("exp"):jq(this.$n("exp")).addClass(c+"-exp-over");break}this.$supers("doMouseOver_",arguments)},doMouseOut_:function(a){var c=this.getZclass();switch(a.domTarget){case this.$n("close"):jq(this.$n("close")).removeClass(c+"-close-over");break;case this.$n("max"):var b=jq(this.$n("max"));if(this._maximized){b.removeClass(c+"-maxd-over")}b.removeClass(c+"-max-over");break;case this.$n("min"):jq(this.$n("min")).removeClass(c+"-min-over");break;case this.$n("exp"):jq(this.$n("exp")).removeClass(c+"-exp-over");break}this.$supers("doMouseOut_",arguments)},domClass_:function(d){var b=this.$supers("domClass_",arguments);if(!d||!d.zclass){var c=this.getZclass();var a=this._bordered()?"":c+"-noborder";if(a){b+=(b?" ":"")+a}a=this._open?"":c+"-colpsd";if(a){b+=(b?" ":"")+a}}return b},onChildAdded_:function(a){this.$supers("onChildAdded_",arguments);if(a.$instanceof(zul.wgt.Caption)){this.caption=a}else{if(a.$instanceof(zul.wnd.Panelchildren)){this.panelchildren=a}else{if(a.$instanceof(zul.wgt.Toolbar)){if(this.firstChild==a||(this.nChildren==(this.caption?2:1))){this.tbar=a}else{if(this.lastChild==a&&a.previousSibling.$instanceof(zul.wgt.Toolbar)){this.fbar=a}else{if(a.previousSibling.$instanceof(zul.wnd.Panelchildren)){this.bbar=a}}}}}}this.rerender()},onChildRemoved_:function(a){this.$supers("onChildRemoved_",arguments);if(a==this.caption){this.caption=null}else{if(a==this.panelchildren){this.panelchildren=null}else{if(a==this.tbar){this.tbar=null}else{if(a==this.bbar){this.bbar=null}else{if(a==this.fbar){this.fbar=null}}}}}if(!this.childReplacing_){this.rerender()}},onChildVisible_:function(a){this.$supers("onChildVisible_",arguments);if((a==this.tbar||a==this.bbar||a==this.fbar)&&this.$n()){this._fixHgh()}}},{_startmove:function(b){b.control._hideShadow();var a=b.node;if(a.style.top&&a.style.top.indexOf("%")>=0){a.style.top=a.offsetTop+"px"}if(a.style.left&&a.style.left.indexOf("%")>=0){a.style.left=a.offsetLeft+"px"}},_ignoremove:function(b,d,a){var c=b.control;switch(a.domTarget){case c.$n("close"):case c.$n("max"):case c.$n("min"):case c.$n("exp"):return true}return false},_aftermove:function(b,a){b.control.zsync()},_startsizing:zul.wnd.Window._startsizing,_ghostsizing:zul.wnd.Window._ghostsizing,_endghostsizing:zul.wnd.Window._endghostsizing,_insizer:zul.wnd.Window._insizer,_ignoresizing:function(e,g,a){var c=e.node,f=e.control;if(f._maximized||!f._open||(a.target!=f&&a.target!=f.panelchildren)){return true}var d=zk(c).revisedOffset(),b=f.$class._insizer(c,d,g[0],g[1]);if(b){f._hideShadow();e.z_dir=b;e.z_box={top:d[1],left:d[0],height:c.offsetHeight,width:c.offsetWidth,minHeight:zk.parseInt(f.getMinheight()),minWidth:zk.parseInt(f.getMinwidth())};e.z_orgzi=c.style.zIndex;return false}return true},_snapsizing:zul.wnd.Window._snapsizing,_aftersizing:zul.wnd.Window._aftersizing,_drawsizing:zul.wnd.Window._drawsizing});zul.wnd.PanelSkipper=zk.$extends(zk.Skipper,{$init:function(a){this._p=a},skip:function(c,b){var a;if(a=jq(b||(c.uuid+"-body"),zk)[0]){a.parentNode.removeChild(a);return a}},restore:function(){this.$supers("restore",arguments);this._p.zsync()}});zul.wnd.PanelRenderer={isFrameRequired:function(a){return a._rounded()}};