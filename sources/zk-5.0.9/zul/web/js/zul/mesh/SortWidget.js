zul.mesh.SortWidget=zk.$extends(zul.mesh.HeaderWidget,{_sortDirection:"natural",_sortAscending:"none",_sortDescending:"none",$define:{sortDirection:function(a){var d=this.$n();if(d){var c=this.getZclass(),b=jq(d);b.removeClass(c+"-sort-dsc").removeClass(c+"-sort-asc").addClass(c+"-sort");switch(a){case"ascending":b.addClass(c+"-sort-asc");break;case"descending":b.addClass(c+"-sort-dsc")}}},sortAscending:function(a){if(!a){this._sortAscending=a="none"}var d=this.$n(),c=this.getZclass();if(d){var b=jq(d);if(a=="none"){b.removeClass(c+"-sort-asc");if(this._sortDescending=="none"){b.removeClass(c+"-sort")}}else{b.addClass(c+"-sort")}}},sortDescending:function(a){if(!a){this._sortDescending=a="none"}var d=this.$n(),c=this.getZclass();if(d){var b=jq(d);if(a=="none"){b.removeClass(c+"-sort-dsc");if(this._sortAscending=="none"){b.removeClass(c+"-sort")}}else{b.addClass(c+"-sort")}}}},$init:function(){this.$supers("$init",arguments);this.listen({onSort:this},-1000)},setSort:function(a){if(a&&a.startsWith("client")){this.setSortAscending(a);this.setSortDescending(a)}else{this.setSortAscending("none");this.setSortDescending("none")}},isSortable_:function(){return this._sortAscending!="none"||this._sortDescending!="none"},sort:function(b,a){if(!this.checkClientSort_(b)){return false}a.stop();this.replaceCavedChildrenInOrder_(b);return true},checkClientSort_:function(b){var a=this.getSortDirection();if(b){if("ascending"==a){return false}}else{if("descending"==a){return false}}var d=b?this._sortAscending:this._sortDescending;if(d=="fromServer"){return false}else{if(d=="none"){evt.stop();return false}}var c=this.getMeshWidget();if(!c||c.isModel()){return false}return true},replaceCavedChildrenInOrder_:function(c){var a=this.getMeshWidget(),m=this.getMeshBody(),o=this.getSortDirection(),q=c?this._sortAscending:this._sortDescending,t=m.desktop,p=m.$n();try{m.unbind();var u=[],e=this.getChildIndex();for(var s=0,j=0,f=a.getBodyWidgetIterator(),l;(l=f.next());j++){for(var r=0,b=l.firstChild;b;b=b.nextSibling,r++){if(r==e){u[s++]={wgt:b,index:j}}}}var g=o=="ascending"?-1:1,h=this.sorting,n=q=="client(number)";u.sort(function(i,d){var k=h(i.wgt,d.wgt,n)*g;if(k==0){k=(i.index<d.index?-1:1)}return k});for(var s=0,r=u.length;s<r;s++){m.appendChild(u[s].wgt.parent)}this._fixDirection(c)}finally{m.replaceHTML(p,t)}},sorting:function(d,c,e){var g,f;if(typeof d.getLabel=="function"){g=d.getLabel()}else{if(typeof d.getValue=="function"){g=d.getValue()}else{g=d}}if(typeof c.getLabel=="function"){f=c.getLabel()}else{if(typeof c.getValue=="function"){f=c.getValue()}else{f=c}}if(e){return g-f}return g>f?1:(g<f?-1:0)},_fixDirection:function(b){for(var a=this.parent.firstChild;a;a=a.nextSibling){a.setSortDirection(a!=this?"natural":b?"ascending":"descending")}},onSort:function(a){var b=this.getSortDirection();if("ascending"==b){this.sort(false,a)}else{if("descending"==b){this.sort(true,a)}else{if(!this.sort(true,a)){this.sort(false,a)}}}},domClass_:function(d){var b=this.$supers("domClass_",arguments);if(!d||!d.zclass){var c=this.getZclass(),a;if(this._sortAscending!="none"||this._sortDescending!="none"){switch(this._sortDirection){case"ascending":a=c+"-sort "+c+"-sort-asc";break;case"descending":a=c+"-sort "+c+"-sort-dsc";break;default:a=c+"-sort";break}}return b!=null?b+(a?" "+a:""):a||""}return b}});