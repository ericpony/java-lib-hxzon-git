(function(){function b(){this._pop=new zul.db.CalendarPop();this._tm=new zul.db.CalendarTime();this.appendChild(this._pop);this.appendChild(this._tm)}function a(l,k){if(!l.$n()){return}var j=l.$n("pp"),m=l.getInputNode();if(j){zk(j).position(m,"after_start");l._pop.syncShadow();if(!k){zk(m).focus()}}}function d(j){var k;if(j._inplace&&j._inplaceout&&(k=j.$n())&&!jq(k).hasClass(j.getInplaceCSS())){jq(k).addClass(j.getInplaceCSS());j.onSize();k.style.width=j.getWidth()||""}}function f(k,j){return(k==j)||(k&&j&&k.getTime()==j.getTime())}function i(l,j,k){var n=[];if(l){n.push(l)}if(j){n.push(j)}if(k){n.push(k)}return n.join(":")}var h={},c=/\'/g,e=zul.db.Datebox=zk.$extends(zul.inp.FormatWidget,{_buttonVisible:true,_lenient:true,$init:function(){this.$supers("$init",arguments);this.afterInit(b);this.listen({onChange:this},-1000)},$define:{buttonVisible:function(j){var m=this.$n("btn"),k=this.getZclass();if(m){if(!this.inRoundedMold()){if(!this._inplace||!j){jq(m)[j?"show":"hide"]()}else{m.style.display=""}jq(this.getInputNode())[j?"removeClass":"addClass"](k+"-right-edge")}else{var l=j?"removeClass":"addClass";jq(m)[l](k+"-btn-right-edge");if(zk.ie6_){jq(m)[l](k+(this._readonly?"-btn-right-edge-readonly":"-btn-right-edge"));if(jq(this.getInputNode()).hasClass(k+"-text-invalid")){jq(m)[l](k+"-btn-right-edge-invalid")}}}this.onSize()}},format:function(){if(this._pop){this._pop.setFormat(this._format);if(this._value){this._value=this._pop.getTime()}}var j=this.getInputNode();if(j){j.value=this.getText()}},constraint:function(j){if(typeof j=="string"&&j.charAt(0)!="["){this._cst=new zul.inp.SimpleDateConstraint(j,this)}else{this._cst=j}if(this._cst){delete this._lastRawValVld}if(this._pop){this._pop.setConstraint(this._constraint);this._pop.rerender()}},timeZone:function(j){this._timezone=j;this._setTimeZonesIndex()},timeZonesReadonly:function(k){var j=this.$n("dtzones");if(j){j.disabled=k?"disabled":""}},displayedTimeZones:function(j){this._dtzones=j.split(",")},lenient:null,localizedSymbols:[function(j){if(j){if(!h[j[0]]){h[j[0]]=j[1]}return h[j[0]]}return j},function(){if(this._tm){this._tm._localizedSymbols=this._localizedSymbols}if(this._pop){this._pop.setLocalizedSymbols(this._localizedSymbols)}}]},_setTimeZonesIndex:function(){var j=this.$n("dtzones");if(j&&this._timezone){var l=jq(j).children("option");for(var k=l.length;k--;){if(l[k].text==this._timezone){j.selectedIndex=k}}}},onSize:function(){var j=this.getWidth();if(!j||j.indexOf("%")!=-1){this.getInputNode().style.width=""}this.syncWidth()},getZclass:function(){var j=this._zclass;return j!=null?j:"z-datebox"+(this.inRoundedMold()?"-rounded":"")},getTimeFormat:function(){var l=this._format,j=l.indexOf("a"),n=l.indexOf("h"),p=l.indexOf("K"),t=l.indexOf("HH"),k=l.indexOf("k"),o=l.indexOf("m"),w=l.indexOf("s"),r=j>-1,s=(r||n)?n>-1||p>-1:false,q,v=o>-1?"mm":"",u=w>-1?"ss":"";if(s){var m=i(n<p?"KK":"hh",v,u);if(j==-1){return m}else{if((n!=-1&&j<n)||(p!=-1&&j<p)){return"a "+m}else{return m+" a"}}}else{return i(t<k?"kk":t>-1?"HH":"",v,u)}},getDateFormat:function(){return this._format.replace(/[ahKHksm]/g,"")},setOpen:function(k,l){var j;if(j=this._pop){if(k){j.open(!l)}else{j.close(!l)}}},isOpen:function(){return this._pop&&this._pop.isOpen()},coerceFromString_:function(k){if(k){var j=new zk.fmt.Calendar().parseDate(k,this.getFormat(),!this._lenient,this._value,this._localizedSymbols);if(!j){return{error:zk.fmt.Text.format(msgzul.DATE_REQUIRED+(this.localizedFormat.replace(c,"")))}}return j}return null},coerceToString_:function(j){return j?new zk.fmt.Calendar().formatDate(j,this.getFormat(),this._localizedSymbols):""},syncWidth:function(){zul.inp.RoundUtl.syncWidth(this,this.$n("btn"))},doFocus_:function(j){var k=this.$n();if(this._inplace){k.style.width=jq.px0(zk(k).revisedWidth(k.offsetWidth))}this.$supers("doFocus_",arguments);if(this._inplace){if(jq(k).hasClass(this.getInplaceCSS())){jq(k).removeClass(this.getInplaceCSS());this.onSize()}}},doClick_:function(j){if(this._disabled){return}if(this._readonly&&this._buttonVisible&&this._pop&&!this._pop.isOpen()){this._pop.open()}this.$supers("doClick_",arguments)},doBlur_:function(j){var k=this.$n();if(this._inplace&&this._inplaceout){k.style.width=jq.px0(zk(k).revisedWidth(k.offsetWidth))}this.$supers("doBlur_",arguments);d(this)},doKeyDown_:function(j){this._doKeyDown(j);if(!j.stopped){this.$supers("doKeyDown_",arguments)}},_doKeyDown:function(j){if(jq.nodeName(j.domTarget,"option","select")){return}var n=j.keyCode,k=this._pop.isOpen();if(n==9||(zk.safari&&n==0)){if(k){this._pop.close()}return}if(j.altKey&&(n==38||n==40)){if(k){this._pop.close()}else{this._pop.open()}var l={propagation:true};if(zk.ie){l.dom=true}j.stop(l);return}if(k&&(n==13||n==27)){if(n==13){this.enterPressed_(j)}else{this.escPressed_(j)}return}if(n==18||n==27||n==13||(n>=112&&n<=123)){return}if(this._pop.isOpen()){var m=n==37?-1:n==39?1:n==38?-7:n==40?7:0;if(m){this._pop._shift(m,{silent:true})}}},enterPressed_:function(j){this._pop.close();this.updateChange_();j.stop()},escPressed_:function(j){this._pop.close();j.stop()},afterKeyDown_:function(j,k){if(!k&&this._inplace){jq(this.$n()).toggleClass(this.getInplaceCSS(),j.keyCode==13?null:false)}return this.$supers("afterKeyDown_",arguments)},bind_:function(){this.$supers(e,"bind_",arguments);var j,k=this.getInputNode();if(this._inplace){jq(k).addClass(this.getInplaceCSS())}if(j=this.$n("btn")){this._auxb=new zul.Auxbutton(this,j,k);this.domListen_(j,"onClick","_doBtnClick")}zWatch.listen({onSize:this});this._pop.setFormat(this.getDateFormat())},unbind_:function(){var j;if(j=this._pop){j.close(true)}if(j=this.$n("btn")){this._auxb.cleanup();this._auxb=null;this.domUnlisten_(j,"onClick","_doBtnClick")}zWatch.unlisten({onSize:this});this.$supers(e,"unbind_",arguments)},_doBtnClick:function(j){if(this.inRoundedMold()&&!this._buttonVisible){return}if(!this._disabled){this.setOpen(!jq(this.$n("pp")).zk.isVisible(),true)}j.stop()},_doTimeZoneChange:function(k){var j=this.$n("dtzones"),l=j.value;this.updateChange_();this.fire("onTimeZoneChange",{timezone:l},{toServer:true},150);if(this._pop){this._pop.close()}},onChange:function(j){if(this._pop){this._pop.setValue(j.data.value)}},getTimeZoneLabel:function(){return""},redrawpp_:function(k){k.push('<div id="',this.uuid,'-pp" class="',this.getZclass(),'-pp" style="display:none" tabindex="-1">');for(var j=this.firstChild;j;j=j.nextSibling){j.redraw(k)}this._redrawTimezone(k);k.push("</div>")},_redrawTimezone:function(l){var n=this._dtzones;if(n){var k=this.getZclass();l.push('<div class="',k,'-timezone">');l.push(this.getTimeZoneLabel());l.push('<select id="',this.uuid,'-dtzones" class="',k,'-timezone-body">');for(var m=0,j=n.length;m<j;m++){l.push('<option value="',n[m],'" class="',k,'-timezone-item">',n[m],"</option>")}l.push("</select><div>")}}});var g=zul.db.CalendarPop=zk.$extends(zul.db.Calendar,{$init:function(){this.$supers("$init",arguments);this.listen({onChange:this},-1000)},setFormat:function(j){this._fmt=j},setLocalizedSymbols:function(j){this._localizedSymbols=j},rerender:function(){this.$supers("rerender",arguments);if(this.desktop){this.syncShadow()}},close:function(l){var k=this.parent,j=k.$n("pp");if(!j||!zk(j).isVisible()){return}if(this._shadow){this._shadow.hide()}var n=k.getZclass();j.style.display="none";j.className=n+"-pp";jq(j).zk.undoVParent();k.setFloating_(false);var m=this.$n("btn");if(m){jq(m).removeClass(n+"-btn-over")}if(l){k.updateChange_()}else{zk(k.getInputNode()).focus()}},isOpen:function(){return zk(this.parent.$n("pp")).isVisible()},open:function(n){var t=this.parent,r=t.$n(),k=t.$n("pp");if(!r||!k){return}t.setFloating_(true,{node:k});zWatch.fire("onFloatUp",t);var q=this.setTopmost();this._setView("day");var j=t.getZclass();k.className=r.className+" "+k.className;jq(k).removeClass(j);k.style.width=k.style.height="auto";k.style.position="absolute";k.style.display="block";k.style.zIndex=q>0?q:1;jq(k).zk.makeVParent();if(k.offsetHeight>200){k.style.width="auto"}else{if(k.offsetHeight<10){k.style.height="10px"}}if(k.offsetWidth<r.offsetWidth){k.style.width=r.offsetWidth+"px"}else{var m=jq.innerWidth()-20;if(m<r.offsetWidth){m=r.offsetWidth}if(k.offsetWidth>m){k.style.width=m}}var o=t.getInputNode();zk(k).position(o,"after_start");setTimeout(function(){a(t,n)},150);var l=t.getTimeFormat(),p=new zk.fmt.Calendar(zk.fmt.Date.parseDate(o.value,t._format,false,t._value,this._localizedSymbols),this._localizedSymbols).toUTCDate()||(o.value?t._value:zUtl.today(l));if(p){this.setValue(p)}if(l){var s=t._tm;s.setVisible(true);s.setFormat(l);s.setValue(p||new Date());s.onSize()}else{t._tm.setVisible(false)}},syncShadow:function(){if(!this._shadow){this._shadow=new zk.eff.Shadow(this.parent.$n("pp"),{left:-4,right:4,top:2,bottom:3})}this._shadow.sync()},onChange:function(l){var o=this.getTime(),n=this.parent,k=n.getTimeFormat(),p=n.getValue(),m=n.isReadonly();if(p){o=new Date(o.getFullYear(),o.getMonth(),o.getDate(),p.getHours(),p.getMinutes(),p.getSeconds(),p.getMilliseconds())}if(k){var j=n._tm,q=j.getValue();o.setHours(q.getHours(),q.getMinutes(),q.getSeconds(),q.getMilliseconds())}n.getInputNode().value=n.coerceToString_(o);if(this._view=="day"&&l.data.shallClose!==false){this.close();n._inplaceout=true;l.data.value=o;if(!f(o,p)){n.updateChange_()}}l.stop()},onFloatUp:function(k){var j=this.parent;if(!zUtl.isAncestor(j,k.origin)){this.close(true);j._inplaceout=true;d(j)}},bind_:function(){this.$supers(g,"bind_",arguments);this._bindTimezoneEvt();zWatch.listen({onFloatUp:this})},unbind_:function(){zWatch.unlisten({onFloatUp:this});this._unbindfTimezoneEvt();if(this._shadow){this._shadow.destroy();this._shadow=null}this.$supers(g,"unbind_",arguments)},_bindTimezoneEvt:function(){var k=this.parent;var j=k.$n("dtzones");if(j){j.disabled=k.isTimeZonesReadonly()?"disable":"";k.domListen_(j,"onChange","_doTimeZoneChange");k._setTimeZonesIndex()}},_unbindfTimezoneEvt:function(){var k=this.parent,j=k.$n("dtzones");if(j){k.domUnlisten_(j,"onChange","_doTimeZoneChange")}},_setView:function(j){if(this.parent.getTimeFormat()){this.parent._tm.setVisible(j=="day")}this.$supers("_setView",arguments)}});zul.db.CalendarTime=zk.$extends(zul.db.Timebox,{$init:function(){this.$supers("$init",arguments);this.listen({onChanging:this},-1000)},onChanging:function(j){var k=this.parent,l=this.coerceFromString_(j.data.value),m=k.getValue();if(m){m=new Date(m);m.setHours(l.getHours());m.setMinutes(l.getMinutes());m.setSeconds(l.getSeconds());m.setMilliseconds(l.getMilliseconds());l=m}k.getInputNode().value=j.data.value=k.coerceToString_(l);k.fire(j.name,j.data);if(this._view=="day"&&j.data.shallClose!==false){this.close();k._inplaceout=true}j.stop()}})})();