zul.inp.Spinner=zk.$extends(zul.inp.NumberInputWidget,{_value:0,_step:1,_buttonVisible:true,$define:{step:_zkf=function(){},buttonVisible:function(a){var d=this.$n("btn"),b=this.getZclass();if(!d){return}if(!this.inRoundedMold()){if(!this._inplace||!a){jq(d)[a?"show":"hide"]()}else{d.style.display=""}jq(this.getInputNode())[a?"removeClass":"addClass"](b+"-right-edge")}else{var c=a?"removeClass":"addClass";jq(d)[c](b+"-btn-right-edge");if(zk.ie6_){jq(d)[c](b+(this._readonly?"-btn-right-edge-readonly":"-btn-right-edge"));if(jq(this.getInputNode()).hasClass(b+"-text-invalid")){jq(d)[c](b+"-btn-right-edge-invalid")}}}this.onSize()}},getZclass:function(){var a=this._zclass;return a!=null?a:"z-spinner"+(this.inRoundedMold()?"-rounded":"")},isButtonVisible:function(){return _buttonVisible},intValue:function(){return this.$supers("getValue",arguments)},setConstraint:function(a){if(typeof a=="string"&&a.charAt(0)!="["){var b=new zul.inp.SimpleSpinnerConstraint(a);this._min=b._min;this._max=b._max;this.$supers("setConstraint",[b])}else{this.$supers("setConstraint",arguments)}},coerceFromString_:function(a){if(!a){return null}var b=zk.fmt.Number.unformat(this._format,a,false,this._localizedSymbols),c=parseInt(b.raw,10);if(b.raw!=""+c&&b.raw!="-"+c){return{error:zk.fmt.Text.format(msgzul.INTEGER_REQUIRED,a)}}if(b.divscale){c=Math.round(c/Math.pow(10,b.divscale))}return c},coerceToString_:function(b){var a=this._format;return a?zk.fmt.Number.format(a,b,this._rounding,this._localizedSymbols):b!=null?""+b:""},onSize:function(){var a=this.getWidth();if(!a||a.indexOf("%")!=-1){this.getInputNode().style.width=""}this.syncWidth()},onHide:zul.inp.Textbox.onHide,validate:zul.inp.Intbox.validate,doKeyDown_:function(a){var b=this.inp;if(b.disabled||b.readOnly){return}switch(a.keyCode){case 38:this.checkValue();this._increase(true);a.stop();return;case 40:this.checkValue();this._increase(false);a.stop();return}this.$supers("doKeyDown_",arguments)},_ondropbtnup:function(a){var b=this.getZclass();jq(this._currentbtn).removeClass(b+"-btn-clk");if(!this.inRoundedMold()){jq(this._currentbtn).removeClass(b+"-btn-up-clk");jq(this._currentbtn).removeClass(b+"-btn-down-clk")}this.domUnlisten_(document.body,"onZMouseUp","_ondropbtnup");this._currentbtn=null},_btnDown:function(b){var d=this.inRoundedMold();if(d&&!this._buttonVisible){return}var e;if(!(e=this.inp)||e.disabled){return}var c=this.$n("btn"),h=this.getZclass();if(!zk.dragging){if(this._currentbtn){this.ondropbtnup(b)}jq(c).addClass(h+"-btn-clk");this.domListen_(document.body,"onZMouseUp","_ondropbtnup");this._currentbtn=c}this.checkValue();var f=zk(c).revisedOffset(),a=(b.pageY-f[1])<c.offsetHeight/2;if(a){this._increase(true);this._startAutoIncProc(true)}else{this._increase(false);this._startAutoIncProc(false)}var g=d?"":a?"-up":"-down";if((c=this.$n("btn"+g))&&!d){jq(c).addClass(h+"-btn"+g+"-clk");this._currentbtn=c}b.stop()},checkValue:function(){var c=this.inp,b=this._min,a=this._max;if(!c.value){if(b&&a){c.value=(b<=0&&0<=a)?0:b}else{if(b){c.value=b<=0?0:b}else{if(a){c.value=0<=a?0:a}else{c.value=0}}}}},_btnUp:function(b){if(this.inRoundedMold()&&!this._buttonVisible){return}var c=this.inp;if(c.disabled){return}this._onChanging();this._stopAutoIncProc();if(zk.ie){var a=c.value.length;zk(c).setSelectionRange(a,a)}c.focus()},_btnOut:function(a){if(this.inRoundedMold()&&!this._buttonVisible){return}if(this.inp&&!this.inp.disabled&&!zk.dragging){jq(this.$n("btn")).removeClass(this.getZclass()+"-btn-over")}var b=this.inp;if(b.disabled){return}this._stopAutoIncProc()},_btnOver:function(a){if(this.inRoundedMold()&&!this._buttonVisible){return}if(this.inp&&!this.inp.disabled&&!zk.dragging){jq(this.$n("btn")).addClass(this.getZclass()+"-btn-over")}},_increase:function(a){var b=this.inp,c=parseInt(b.value,10);if(a){result=c+this._step}else{result=c-this._step}if(result>Math.pow(2,31)-1){result=Math.pow(2,31)-1}else{if(result<-Math.pow(2,31)){result=-Math.pow(2,31)}}if(this._max!=null&&result>this._max){result=c}else{if(this._min!=null&&result<this._min){result=c}}b.value=result;this._onChanging()},_clearValue:function(){var a=this.inp;a.value=this._defValue="";return true},_startAutoIncProc:function(a){var b=this;if(this.timerId){clearInterval(this.timerId)}this.timerId=setInterval(function(){b._increase(a)},200)},_stopAutoIncProc:function(){if(this.timerId){clearTimeout(this.timerId)}this.timerId=null},syncWidth:function(){zul.inp.RoundUtl.syncWidth(this,this.$n("btn"))},doFocus_:function(a){var b=this.$n();if(this._inplace){b.style.width=jq.px0(zk(b).revisedWidth(b.offsetWidth))}this.$supers("doFocus_",arguments);if(this._inplace){if(jq(b).hasClass(this.getInplaceCSS())){jq(b).removeClass(this.getInplaceCSS());this.onSize()}}},doBlur_:function(a){var b=this.$n();if(this._inplace&&this._inplaceout){b.style.width=jq.px0(zk(b).revisedWidth(b.offsetWidth))}this.$supers("doBlur_",arguments);if(this._inplace&&this._inplaceout){jq(b).addClass(this.getInplaceCSS());this.onSize();b.style.width=this.getWidth()||""}},afterKeyDown_:function(a,b){if(!b&&this._inplace){jq(this.$n()).toggleClass(this.getInplaceCSS(),a.keyCode==13?null:false)}return this.$supers("afterKeyDown_",arguments)},bind_:function(){this.$supers(zul.inp.Spinner,"bind_",arguments);this.timeId=null;var b=this.inp=this.$n("real"),a;if(this._inplace){jq(b).addClass(this.getInplaceCSS())}if(a=this.$n("btn")){this.domListen_(a,"onZMouseDown","_btnDown").domListen_(a,"onZMouseUp","_btnUp").domListen_(a,"onMouseOut","_btnOut").domListen_(a,"onMouseOver","_btnOver")}zWatch.listen({onSize:this})},unbind_:function(){if(this.timerId){clearTimeout(this.timerId);this.timerId=null}zWatch.unlisten({onSize:this});var a=this.$n("btn");if(a){this.domUnlisten_(a,"onZMouseDown","_btnDown").domUnlisten_(a,"onZMouseUp","_btnUp").domUnlisten_(a,"onMouseOut","_btnOut").domUnlisten_(a,"onMouseOver","_btnOver")}this.$supers(zul.inp.Spinner,"unbind_",arguments)}});