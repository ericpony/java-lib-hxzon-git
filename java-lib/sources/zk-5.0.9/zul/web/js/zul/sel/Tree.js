zul.sel.Tree=zk.$extends(zul.sel.SelectWidget,{clear:function(){if(!this._treechildren||!this._treechildren.nChildren){return}for(var a=this._treechildren.firstChild;a;a=a.nextSibling){a.detach()}},getZclass:function(){return this._zclass==null?"z-tree":this._zclass},insertBefore:function(c,b,a){if(this.$super("insertBefore",c,b,!this.z_rod)){this._fixOnAdd(c,a,a);return true}},appendChild:function(b,a){if(this.$super("appendChild",b,!this.z_rod)){if(!this.insertingBefore_){this._fixOnAdd(b,a,a)}return true}},_fixOnAdd:function(c,b,a){if(c.$instanceof(zul.sel.Treecols)){this.treecols=c}else{if(c.$instanceof(zul.sel.Treechildren)){this.treechildren=c;this._fixSelectedSet()}else{if(c.$instanceof(zul.mesh.Paging)){this.paging=c}else{if(c.$instanceof(zul.sel.Treefoot)){this.treefoot=c}}}}if(!b){this.rerender()}if(!a){this._syncSize()}},onChildRemoved_:function(a){this.$supers("onChildRemoved_",arguments);if(a==this.treecols){this.treecols=null}else{if(a==this.treefoot){this.treefoot=null}else{if(a==this.treechildren){this.treechildren=null;this._selItems=[];this._sel=null}else{if(a==this.paging){this.paging=null}}}}if(!this.childReplacing_){this._syncSize()}},onChildAdded_:function(a){this.$supers("onChildAdded_",arguments);if(this.childReplacing_){this._fixOnAdd(a,true)}},_onTreeitemAdded:function(a){this._fixNewChild(a);this._onTreechildrenAdded(a.treechildren)},_onTreeitemRemoved:function(b){var c,a;if(b.isSelected()){this._selItems.$remove(b);c=this._sel==b;if(c&&!this._multiple){this._sel=null}}this._onTreechildrenRemoved(b.treechildren);if(c){this._fixSelected()}if(a=b.previousSibling||b.getParentItem()){this._syncFocus(a)}else{jq(this.$n("a")).offset({top:0,left:0})}},_onTreechildrenAdded:function(d){if(!d||d.parent==this){return}for(var c=0,b=d.getItems(),a=b.length;c<a;++c){if(b[c]){this._fixNewChild(b[c])}}},_onTreechildrenRemoved:function(f){if(f==null||f.parent==this){return}var d,e;for(var c=0,b=f.getItems(),a=b.length;c<a;++c){d=b[c];if(d.isSelected()){this._selItems.$remove(d);if(this._sel==d){if(!this._multiple){this._sel=null;return}e=true}}}if(e){this._fixSelected()}},_fixNewChild:function(a){if(a.isSelected()){if(this._sel&&!this._multiple){a._selected=false;a.rerender()}else{if(!this._sel){this._sel=a}this._selItems.push(a)}}},_fixSelectedSet:function(){this._sel=null;this._selItems=[];for(var c=0,b=this.getItems(),a=b.length;c<a;++c){if(b[c].isSelected()){if(this._sel==null){this._sel=b[c]}else{if(!_multiple){b[c]._selected=false;continue}}this._selItems.push(item)}}},_fixSelected:function(){var d;switch(this._selItems.length){case 1:d=this._selItems[0];case 0:break;default:for(var c=0,b=this.getItems(),a=b.length;c<a;++c){if(b[c].isSelected()){d=b[c];break}}}if(d!=this._sel){this._sel=d;return true}return false},_sizeOnOpen:function(){var c=this.treecols,a,b;if(!c||this.isSizedByContent()||this._hflex=="min"){this.syncSize()}else{for(a=c.firstChild;a;a=a.nextSibling){if(a._hflex||!(b=a._width)||b=="auto"){this.syncSize();return}}}},getHeadWidgetClass:function(){return zul.sel.Treecols},itemIterator:_zkf=function(a){return new zul.sel.TreeItemIter(this,a)},getBodyWidgetIterator:_zkf,getItems:function(a){return this.treechildren?this.treechildren.getItems(null,a):[]},getItemCount:function(){return this.treechildren!=null?this.treechildren.getItemCount():0},_doLeft:function(a){if(a.isOpen()){a.setOpen(false)}},_doRight:function(a){if(!a.isOpen()){a.setOpen(true)}},shallIgnoreSelect_:function(a){var b=a.domTarget;return b&&b.id&&b.id.endsWith("-open")||(a.name=="onRightClick"&&!this.rightSelect)}});zul.sel.TreeItemIter=zk.$extends(zk.Object,{$init:function(a,b){this.tree=a;this.opts=b},_init:function(){if(!this._isInit){this._isInit=true;this.items=this.tree.getItems(this.opts);this.length=this.items.length;this.cur=0}},hasNext:function(){this._init();return this.cur<this.length},next:function(){this._init();return this.items[this.cur++]}});