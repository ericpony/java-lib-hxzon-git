zul.mesh.HeaderWidget=zk.$extends(zul.LabelImageWidget,{_sumWidth:true,$define:{align:function(a){this.updateMesh_("align",a)},valign:function(a){this.updateMesh_("valign",a)},width:_zkf=function(){this.updateMesh_()},height:_zkf},updateMesh_:function(a,c){if(this.desktop){var b=this.getMeshWidget();if(b){b.rerender(0)}}},setFlexSize_:function(b){if((b.width!==undefined&&b.width!="auto"&&b.width!="")||b.width==0){var a=this._hflex=="min"&&this.firstChild&&this.isRealVisible()?zk(this.$n("cave")).revisedWidth(b.width):b.width;this._hflexWidth=a;return{width:a}}else{return this.$supers("setFlexSize_",arguments)}},domStyle_:function(b){var a="";if(this._hflexWidth){a="width: "+this._hflexWidth+"px;";if(b){b.width=true}else{b={width:true}}}if(zk.ie8&&this._align){a+="text-align:"+this._align+";"}return a+this.$super("domStyle_",b)},getMeshWidget:function(){return this.parent?this.parent.parent:null},isSortable_:function(){return false},getColAttrs:function(){return(this._align?' align="'+this._align+'"':"")+(this._valign?' valign="'+this._valign+'"':"")},setVisible:function(a){if(this.isVisible()!=a){this.$supers("setVisible",arguments);this.updateMesh_("visible",a)}},domAttrs_:function(b){var a=this.$supers("domAttrs_",arguments);return a+this.getColAttrs()},getTextNode:function(){return jq(this.$n()).find(">div:first")[0]},bind_:function(){this.$supers(zul.mesh.HeaderWidget,"bind_",arguments);if(this.parent.isSizable()){this._initsz()}this.fixFaker_()},unbind_:function(){if(this._dragsz){this._dragsz.destroy();this._dragsz=null}this.$supers(zul.mesh.HeaderWidget,"unbind_",arguments)},_initsz:function(){var b=this.$n();if(b&&!this._dragsz){var a=this.$class;this._dragsz=new zk.Draggable(this,null,{revert:true,constraint:"horizontal",ghosting:a._ghostsizing,endghosting:a._endghostsizing,snap:a._snapsizing,ignoredrag:a._ignoresizing,zIndex:99999,endeffect:a._aftersizing})}},fixFaker_:function(){var f=this.$n(),d=zk(f).cellIndex(),b=this.getMeshWidget();for(var c,a=this.$class._faker,e=a.length;e--;){c=b["e"+a[e]];if(c&&!this.$n(a[e])){c[c.cells.length>d?"insertBefore":"appendChild"](this._createFaker(f,a[e]),c.cells[d])}}},_createFaker:function(e,c){var a=document.createElement("th"),b=document.createElement("div");a.id=e.id+"-"+c;a.className=e.className;a.style.cssText=e.style.cssText;b.style.overflow="hidden";a.appendChild(b);return a},doClick_:function(a){var c=zk.Widget.$(a.domTarget),d=this.$n(),b=this._dragsz?zk(d).revisedOffset():false;if(!zk.dragging&&(c==this||c.$instanceof(zul.wgt.Label))&&this.isSortable_()&&!jq.nodeName(a.domTarget,"input")&&(!this._dragsz||!this._insizer(a.pageX-b[0]))){this.fire("onSort","ascending"!=this.getSortDirection());a.stop()}else{if(jq.nodeName(a.domTarget,"input")){a.stop({propagation:true})}this.$supers("doClick_",arguments)}},doDoubleClick_:function(c){if(this._dragsz){var h=this.$n(),d=zk(h),e=d.revisedOffset();if(this._insizer(c.pageX-e[0])){var g=this.getMeshWidget(),b=zk(this.$n("cave")).textSize()[0],a=d.cellIndex();g._calcMinWds();var f=g._minWd.wds[a];this.$class._aftersizing({control:this,_zszofs:f},c)}else{this.$supers("doDoubleClick_",arguments)}}else{this.$supers("doDoubleClick_",arguments)}},doMouseMove_:function(a){if(zk.dragging||!this.parent.isSizable()){return}var c=this.$n(),b=zk(c).revisedOffset();if(this._insizer(a.pageX-b[0])){jq(c).addClass(this.getZclass()+"-sizing")}else{jq(c).removeClass(this.getZclass()+"-sizing")}},doMouseOut_:function(a){if(this.parent.isSizable()){var b=this.$n();jq(b).removeClass(this.getZclass()+"-sizing")}this.$supers("doMouseOut_",arguments)},ignoreDrag_:function(b){if(this.parent.isSizable()){var c=this.$n(),a=zk(c).revisedOffset();return this._insizer(b[0]-a[0])}return false},ignoreChildNodeOffset_:function(a){return true},listenOnFitSize_:zk.$void,unlistenOnFitSize_:zk.$void,beforeMinFlex_:function(d){if(d=="w"){var c=this.getMeshWidget();if(c){c._calcMinWds();if(c._minWd){var e=this.$n(),b=zk(e),a=b.cellIndex();return b.revisedWidth(c._minWd.wds[a])}}}return null},clearCachedSize_:function(){this.$supers("clearCachedSize_",arguments);var a;if(a=this.getMeshWidget()){a._clearCachedSize()}},getParentSize_:function(){var f=this.getMeshWidget(),d=f.$n(),e=d?zk(d):null;if(e){var b=e.revisedWidth(d.offsetWidth);if(f.ebody){var a=f.ebody.offsetWidth-f.ebody.clientWidth;if(a>11){b-=a;if(zk.ie){var c=jq(f.ehead).find("table>tbody>tr>th:last-child")[0];c.style.width="";if(f.ebodytbl){f.ebodytbl.width=""}}}else{if(zk.ie&&f.ebodytbl){if(f.ebodytbl&&!f.ebodytbl.width){f.ebodytbl.width="100%"}}}}return{height:e.revisedHeight(d.offsetHeight),width:b}}return{}},isWatchable_:function(b,d,a){var c;return this._visible&&(c=this.parent)&&c._visible&&(c=c.parent)&&c.isWatchable_(b,d,a)},_insizer:function(a){return a>=this.$n().offsetWidth-10},deferRedrawHTML_:function(a){a.push("<th",this.domAttrs_({domClass:1}),' class="z-renderdefer"></th>')}},{_faker:["hdfaker","bdfaker","ftfaker"],_ghostsizing:function(d,c,a){var f=d.control,b=f.getMeshWidget().eheadtbl,e=zk(b).revisedOffset(),g=f.$n();c[1]=e[1];c[0]+=zk(g).offsetWidth();jq(document.body).append('<div id="zk_hdghost" style="position:absolute;top:'+c[1]+"px;left:"+c[0]+"px;width:3px;height:"+zk(b.parentNode.parentNode).offsetHeight()+'px;background:darkgray"></div>');return jq("#zk_hdghost")[0]},_endghostsizing:function(b,a){b._zszofs=zk(b.node).revisedOffset()[0]-zk(a).revisedOffset()[0]},_snapsizing:function(c,d){var e=c.control.$n(),a=zk(e),b=a.revisedOffset();d[0]+=a.offsetWidth();if(b[0]+c._zmin>=d[0]){d[0]=b[0]+c._zmin}return d},_ignoresizing:function(d,f,a){var e=d.control,g=e.$n(),b=zk(g),c=b.revisedOffset();if(e._insizer(f[0]-c[0])){d._zmin=10+b.padBorderWidth();return false}return true},_aftersizing:function(B,u){var p=B.control,v=p.$n(),C=zk(v),a=p.getMeshWidget(),m=B._zszofs,A=a.eheadtbl,h=A.tBodies[0].rows[0],r=C.revisedWidth(m),l=C.cellIndex();if(a.efoottbl){a.eftfaker.cells[l].style.width=m+"px"}var g,y;if(a.ebodytbl){if(zk.opera&&!a.ebodytbl.style.tableLayout){g="auto";a.ebodytbl.style.tableLayout="fixed"}a.ebdfaker.cells[l].style.width=m+"px"}h.cells[l].style.width=m+"px";v.style.width=r+"px";var c=v.firstChild;c.style.width=zk(c).revisedWidth(r)+"px";var e=a.ehdfaker.cells,d=a.ebdfaker.cells,q=[];z=0;for(var s=a.head.firstChild,z=0;s;s=s.nextSibling){var k=e[z].style.width;s._width=q[z]=k?k:jq.px0(e[z].offsetWidth);if(!k){d[z].style.width=e[z].style.width=s._width}++z}delete a._span;delete a._sizedByContent;for(var s=a.head.firstChild;s;s=s.nextSibling){s.setHflex_(null)}var f=jq(a.ehead).find("table>tbody>tr>th:last-child")[0],o=jq(a.ebody).find("table>tbody>tr>th:last-child")[0],b=f.style.width;f.style.width="";if(zk.ie<8){if(f.offsetWidth==1){f.style.width=b}}if(o){var x=o.style.width;o.style.width="";if(zk.ie<8){if(o.offsetWidth==1){o.style.width=x}}}var D=a.$n();if(zk.opera){if(g){a.ebodytbl.style.tableLayout=g}var t=D.style.display;D.style.display="none";var j=D.offsetHeight;D.style.display=t}p.parent.fire("onColSize",zk.copy({index:l,column:p,width:m+"px",widths:q},u.data),null,0);D._lastsz=null;zUtl.fireSized(a,-1);if(zk.ie<8){zk(a).redoCSS()}},redraw:function(b){var c=this.uuid,d=this.getZclass();b.push("<th",this.domAttrs_(),'><div id="',c,'-cave" class="',d,'-cnt"',this.domTextStyleAttr_(),'><div class="',d,'-sort-img"></div>',this.domContent_());if(this.parent._menupopup&&this.parent._menupopup!="none"){b.push('<a id="',c,'-btn"  href="javascript:;" class="',d,'-btn"></a>')}for(var a=this.firstChild;a;a=a.nextSibling){a.redraw(b)}b.push("</div></th>")}});