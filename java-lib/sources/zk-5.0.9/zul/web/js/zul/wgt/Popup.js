zul.wgt.Popup=zk.$extends(zul.Widget,{_visible:false,isOpen:function(){return this.isVisible()},open:function(c,f,g,b){var e=this._posInfo(c,f,g),d=this.$n(),j=d.style.top,i=jq(d);this._openInfo=arguments;i.css({position:"absolute"}).zk.makeVParent();zWatch.fireDown("onVParent",this);if(e){i.zk.position(e.dim,e.pos,b)}this.setFloating_(true);this.setVisible(true);this.setTopmost();if((!b||!b.disableMask)&&this.isListen("onOpen",{asapOnly:true})){if(this.mask){this.mask.destroy()}this.mask=new zk.eff.Mask({id:this.uuid+"-mask",anchor:d});zWatch.listen({onResponse:this})}if(this.shallStackup_()){if(!this._stackup){this._stackup=jq.newStackup(d,d.id+"-stk")}else{var h,a;(h=this._stackup.style).top=(a=d.style).top;h.left=a.left;h.zIndex=a.zIndex;h.display="block"}}c=zk.Widget.$(c);if(b&&b.sendOnOpen){this.fire("onOpen",{open:true,reference:c})}},shallStackup_:function(){return zk.eff.shallStackup()},position:function(d,e,b,c){var a=this._posInfo(d,e,b);if(a){zk(this.$n()).position(a.dim,a.pos,c)}},_posInfo:function(c,f,a,b){var g,e;if(c&&a){if(typeof c=="string"){c=zk.Widget.$(c)}if(c){var d=zul.Widget.isInstance(c)?c.$n():c;g=a;e=zk(d).dimension(true)}}else{if(jq.isArray(f)){e={left:zk.parseInt(f[0]),top:zk.parseInt(f[1]),width:0,height:0}}}if(e){return{pos:g,dim:e}}},onResponse:function(){if(this.mask){this.mask.destroy()}var a=this._openInfo;if(a){this.position.apply(this,a);this._openInfo=null}zWatch.unlisten({onResponse:this});this.mask=null},close:function(a){if(this._stackup){this._stackup.style.display="none"}this.setVisible(false);zk(this.$n()).undoVParent();zWatch.fireDown("onVParent",this);this.setFloating_(false);if(a&&a.sendOnOpen){this.fire("onOpen",{open:false})}},getZclass:function(){var a=this._zclass;return a!=null?a:"z-popup"},onFloatUp:function(a){if(!this.isVisible()){return}var c=a.origin;for(var b;c;c=c.parent){if(c==this){if(!b){this.setTopmost()}return}b=b||c.isFloating_()}this.close({sendOnOpen:true})},bind_:function(){this.$supers(zul.wgt.Popup,"bind_",arguments);zWatch.listen({onFloatUp:this,onShow:this});this.setFloating_(true)},unbind_:function(){zk(this.$n()).undoVParent();if(this._stackup){jq(this._stackup).remove();this._stackup=null}if(this._openInfo){this._openInfo=null}zWatch.unlisten({onFloatUp:this,onShow:this});this.setFloating_(false);this.$supers(zul.wgt.Popup,"unbind_",arguments)},onShow:function(a){a.fire(this.firstChild);var b=this._openInfo;if(b){this.position.apply(this,b)}this._fixWdh();this._fixHgh()},_offsetHeight:function(){var d=this.$n(),b=zul.wgt.PopupRenderer.isFrameRequired(),c=d.offsetHeight-(b?1:0),e=this.$n("body");if(b){var a=jq(d).find("> div:first-child")[0],g=jq(d).find("> div:last")[0],f=this.getCaveNode().parentNode,e=this.$n("body");c-=a.offsetHeight;c-=g.offsetHeight;c-=zk(f).padBorderHeight();c-=zk(e).padBorderHeight()}else{c-=zk(e).padBorderHeight()}return c},_fixHgh:function(){var a=this.$n().style.height,b=this.getCaveNode();if(zk.ie6_&&((a&&a!="auto")||b.style.height)){b.style.height="0px"}if(a&&a!="auto"){zk(b).setOffsetHeight(this._offsetHeight())}else{b.style.height="auto"}},_fixWdh:zk.ie7_?function(){if(!zul.wgt.PopupRenderer.isFrameRequired()){return}var d=this.$n(),a=d.style.width,g=jq(d).children("div"),c=g[0],b=g[g.length-1],f=this.$n("cave").parentNode;if(!a||a=="auto"){var e=zk(f.parentNode).padBorderWidth()+zk(f.parentNode.parentNode).padBorderWidth();if(c){c.firstChild.style.width=jq.px0(f.offsetWidth-(zk(c).padBorderWidth()+zk(c.firstChild).padBorderWidth()-e))}if(b){b.firstChild.style.width=jq.px0(f.offsetWidth-(zk(b).padBorderWidth()+zk(b.firstChild).padBorderWidth()-e))}}else{if(c){c.firstChild.style.width=""}if(b){b.firstChild.style.width=""}}}:zk.$void,setHeight:function(a){this.$supers("setHeight",arguments);if(this.desktop){zUtl.fireShown(this)}},setWidth:function(a){this.$supers("setWidth",arguments);if(this.desktop){zWatch.fireDown("onShow",this)}},prologHTML_:function(a){},epilogHTML_:function(a){}});zul.wgt.PopupRenderer={isFrameRequired:function(){return true}};