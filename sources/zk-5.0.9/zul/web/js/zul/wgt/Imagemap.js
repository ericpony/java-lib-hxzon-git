zul.wgt.Imagemap=zk.$extends(zul.wgt.Image,{$define:{width:function(a){var b=this.getImageNode();if(b){b.style.width=a}},height:function(a){var b=this.getImageNode();if(b){b.style.height=a}}},bind_:function(){this.$supers(zul.wgt.Imagemap,"bind_",arguments);if(!jq("#zk_hfr_")[0]){jq.newFrame("zk_hfr_",null,zk.safari?"position:absolute;top:-1000px;left:-1000px;width:0;height:0;display:inline":null)}},getImageNode:function(){return this.$n("real")},getCaveNode:function(){return this.$n("map")},doClick_:function(a){},onChildAdded_:function(){this.$supers("onChildAdded_",arguments);if(this.desktop&&this.firstChild==this.lastChild){this._fixchd(true)}},onChildRemoved_:function(){this.$supers("onChildRemoved_",arguments);if(this.desktop&&!this.firstChild){this._fixchd(false)}},_fixchd:function(b){var a=this.uuid+"-map";img=this.getImageNode();img.useMap=b?"#"+a:"";img.isMap=!b},contentAttrs_:function(){var a=this.$supers("contentAttrs_",arguments),b=this._width,c=this._height;if(b||c){a+=' style="';if(b){a+="width:"+b+";"}if(c){a+="height:"+c+";"}a+='"'}return a+(this.firstChild?' usemap="#'+this.uuid+'-map"':' ismap="ismap"')},fromPageCoord:function(a,c){var b=zk(this.getImageNode()).revisedOffset();return[a-b[0],c-b[1]]},_doneURI:function(){var a=zul.wgt.Imagemap,b=a._doneURI;return b?b:a._doneURI=zk.IMAGEMAP_DONE_URI?zk.IMAGEMAP_DONE_URI:zk.ajaxURI("/web/zul/html/imagemap-done.html",{desktop:this.desktop,au:true})}},{onclick:function(b){if(zul.wgt.Imagemap._toofast()){return}var c=b.indexOf("?");if(c<0){return}var a=b.indexOf("?",++c);if(a<0){return}var e=b.substring(c,a),d=zk.Widget.$(e);if(!d){return}c=b.indexOf(",",++a);if(c<0){return}d.fire("onClick",{x:zk.parseInt(b.substring(a,c)),y:zk.parseInt(b.substring(c+1))},{ctl:true})},_toofast:function(){if(zk.gecko){var a=zul.wgt.Imagemap,b=jq.now();if(a._stamp&&b-a._stamp<800){return true}a._stamp=b}return false}});