zul.box.Layout=zk.$extends(zk.Widget,{_spacing:"0.3em",$define:{spacing:function(){var c=this.$n(),a=this.isVertical_(),b=this._spacing;if(c){jq(c).children("div:not(:last-child)").css("padding-"+(a?"bottom":"right"),(b&&b!="auto")?b:"")}}},_chdextr:function(a){return a.$n("chdex")||a.$n()},insertChildHTML_:function(e,b,d){if(b){jq(this._chdextr(b)).before(this.encloseChildHTML_(e))}else{var c=jq(this.$n()),a=this._spacing;c.children("div:last-child").css("padding-"+(this.isVertical_()?"bottom":"right"),(a&&a!="auto")?a:"");c.append(this.encloseChildHTML_(e))}e.bind(d)},bind_:function(){this.$supers(zul.box.Layout,"bind_",arguments);zWatch.listen({onResponse:this})},unbind_:function(){zWatch.unlisten({onResponse:this});this.$supers(zul.box.Layout,"unbind_",arguments)},syncSize:function(){this._shallSize=false;if(this.desktop){zUtl.fireSized(this)}},onResponse:function(){if(this._shallSize){this.syncSize()}},onChildAdded_:function(){this.$supers("onChildRemoved_",arguments);this._shallSize=true},onChildRemoved_:function(){this.$supers("onChildRemoved_",arguments);this._shallSize=true},removeChildHTML_:function(b){this.$supers("removeChildHTML_",arguments);jq(b.uuid+"-chdex",zk).remove();var a=this.lastChild==b;if(this._spacing!="auto"&&this.lastChild==b){jq(this.$n()).children("div:last-child").css("padding-"+(this.isVertical_()?"bottom":"right"),"")}},encloseChildHTML_:function(g,e){var b=[],c=this.isVertical_(),f=this._spacing;b.push('<div id="',g.uuid,'-chdex" class="',this.getZclass(),'-inner"');if(f&&f!="auto"&&g.nextSibling){b.push(' style="padding-'+(c?"bottom:":"right:")+f+'"')}b.push(">");g.redraw(b);b.push("</div>");if(!e){return b.join("")}for(var d=0,a=b.length;d<a;++d){e.push(b[d])}},isVertical_:zk.$void,_resetBoxSize:function(){var g=this.isVertical_();for(var e=this.firstChild;e;e=e.nextSibling){if(g?(e._nvflex&&e.getVflex()!="min"):(e._nhflex&&e.getHflex()!="min")){e.setFlexSize_({height:"",width:""});var i=e.$n("chdex");if(i){i.style.height="";i.style.width=""}}}var b=this.$n(),f=zk(b),k=b.offsetHeight,c=b.offsetWidth,j=this._vflexsz!==undefined?this._vflexsz-f.sumStyles("tb",jq.margins):k,a=this._hflexsz!==undefined?this._hflexsz-f.sumStyles("lr",jq.margins):c;if(f.hasHScroll()){k-=jq.scrollbarWidth()}if(f.hasVScroll()){c-=jq.scrollbarWidth()}var d=f.revisedHeight(j<k?j:k),h=f.revisedWidth(a<c?a:c);return f?{height:d,width:h}:{}},afterResetChildSize_:function(b){for(var a=this.firstChild;a;a=a.nextSibling){var c=a.$n("chdex");if(c){if(b=="h"){c.style.height=""}if(b=="w"){c.style.width=""}}}},resetSize_:function(c){this.$supers(zul.box.Layout,"resetSize_",arguments);var b=this.isVertical_();for(var a=this.firstChild;a;a=a.nextSibling){if(b?(a._nvflex&&a.getVflex()!="min"):(a._nhflex&&a.getHflex()!="min")){var d=a.$n("chdex");if(d){if(c=="h"){d.style.height=""}if(c=="w"){d.style.width=""}}}}},getChildMinSize_:function(a,c){var b=c.$n().parentNode;return a=="h"?zk(b).offsetHeight():zjq.minWidth(b)},beforeChildrenFlex_:function(f){if(f._flexFixed||(!f._nvflex&&!f._nhflex)){delete f._flexFixed;return false}f._flexFixed=true;var r=this.isVertical_(),t=[],y=r?0:1,a=[],v=!r?0:1,k=f.$n("chdex").parentNode,i=this._resetBoxSize(),h=i.height,m=i.width,o=k.firstChild;for(;o;o=o.nextSibling){var w=o.id&&o.id.endsWith("-chdex")?o.firstChild:o,s=zk(w);if(s.isVisible()){var q=w.id?w.id.indexOf("-"):1,e=q<0?zk.Widget.$(w.id):null,d=zk(o);if(e&&e._nvflex){if(e!==f){e._flexFixed=true}if(e._vflex=="min"){e.fixMinFlex_(w,"h");o.style.height=jq.px0(d.revisedHeight(w.offsetHeight+s.sumStyles("tb",jq.margins)));if(r){h-=o.offsetHeight+d.sumStyles("tb",jq.margins)}}else{t.push(e);if(r){y+=e._nvflex;h=d.revisedHeight(h,true)}}}else{if(r){h-=o.offsetHeight+d.sumStyles("tb",jq.margins)}}if(e&&e._nhflex){if(e!==f){e._flexFixed=true}if(e._hflex=="min"){e.fixMinFlex_(w,"w");o.style.width=jq.px0(d.revisedWidth(w.offsetWidth+s.sumStyles("lr",jq.margins)));if(!r){m-=o.offsetWidth+d.sumStyles("lr",jq.margins)}}else{a.push(e);if(!r){v+=e._nhflex;m=d.revisedWidth(m,true)}}}else{if(!r){m-=o.offsetWidth+d.sumStyles("lr",jq.margins)}}}}var x=h>0?h:0;for(var q=t.length;--q>0;){var e=t.shift(),u=(r?(e._nvflex*h/y):h)|0,g=e.$n().offsetTop,l=u-((zk.ie&&g>0)?(g*2):(zk.ie<8?1:0));e.setFlexSize_({height:l});e._vflexsz=u;var n=e.$n("chdex");n.style.height=jq.px0(u);if(r){x-=u}}if(t.length){var e=t.shift(),g=e.$n().offsetTop,l=x-((zk.ie&&g>0)?(g*2):(zk.ie<8?1:0));e.setFlexSize_({height:l});e._vflexsz=x;var n=e.$n("chdex");n.style.height=jq.px0(x)}x=m>0?m:0;for(var q=a.length;--q>0;){var e=a.shift(),b=(r?m:(e._nhflex*m/v))|0;e.setFlexSize_({width:b});e._hflexsz=b;var n=e.$n("chdex");n.style.width=jq.px0(b);if(!r){x-=b}}if(a.length){var e=a.shift();e.setFlexSize_({width:x});e._hflexsz=x;var n=e.$n("chdex");n.style.width=jq.px0(x)}f.parent.afterChildrenFlex_(f);f._flexFixed=false;return false},afterChildrenMinFlex_:function(f){var g=this.$n();if(f=="h"){if(this.isVertical_()){var e=0;for(var b=g.firstChild;b;b=b.nextSibling){if(b.firstChild.style.height){b.style.height=jq.px0(b.firstChild.offsetHeight+zk(b.firstChild).sumStyles("tb",jq.margins))}e+=b.offsetHeight}g.style.height=jq.px0(e)}else{var a=0;for(var b=g.firstChild;b;b=b.nextSibling){var d=b.firstChild.offsetHeight;if(d>a){a=d}}g.style.height=jq.px0(a)}}else{if(!this.isVertical_()){var e=0;for(var b=g.firstChild;b;b=b.nextSibling){if(b.firstChild.style.width){b.style.width=jq.px0(b.firstChild.offsetWidth+zk(b.firstChild).sumStyles("lr",jq.margins))}e+=b.offsetWidth}if(zk.ie9&&this._hflexsz){e=Math.max(this._hflexsz,e)}g.style.width=jq.px0(e)}else{var a=0;for(var b=g.firstChild;b;b=b.nextSibling){var c=b.firstChild.offsetWidth;if(c>a){a=c}}g.style.width=jq.px0(a)}}}});