(function(){var a=zk.gecko?function(e,d){if(d){setTimeout(function(){zk(e).focus()})}else{zk(e).focus()}}:function(d){zk(d).focus()};function c(f,g,e,h){var d=new Date(f,g,e);return h&&d.getMonth()!=g?new Date(f,g+1,0):d}zul.db.Renderer={cellHTML:function(g,h,d,e,f){return e},beforeRedraw:function(d){},disabled:function(j,l,f,h,g){var k=new Date(l,f,h,0,0,0,0),i;if((i=j._constraint)&&typeof i=="string"){if((i.indexOf("no past")>-1&&(k-g)/86400000<0)||(i.indexOf("no future")>-1&&(g-k)/86400000<0)||(i.indexOf("no today")>-1&&g-k==0)){return true}}var e=false;if(j._beg&&(e=(k-j._beg)/86400000<0)){return e}if(j._end&&(e=(j._end-k)/86400000<0)){return e}return e}};var b=zul.db.Calendar=zk.$extends(zul.Widget,{_view:"day",$init:function(){this.$supers("$init",arguments);this.listen({onChange:this},-1000)},$define:{value:function(){this.rerender()},constraint:function(){var f=this._constraint||"";if(typeof this._constraint!="string"){return}if(f.startsWith("between")){var e=f.indexOf("and",7);if(e<0&&zk.debugJS){zk.error("Unknown constraint: "+f)}this._beg=new zk.fmt.Calendar(null,this._localizedSymbols).parseDate(f.substring(7,e),"yyyyMMdd");this._end=new zk.fmt.Calendar(null,this._localizedSymbols).parseDate(f.substring(e+3),"yyyyMMdd");if(this._beg.getTime()>this._end.getTime()){var g=this._beg;this._beg=this._end;this._end=g}this._beg.setHours(0,0,0,0);this._end.setHours(0,0,0,0)}else{if(f.startsWith("before")){this._end=new zk.fmt.Calendar(null,this._localizedSymbols).parseDate(f.substring(6),"yyyyMMdd");this._end.setHours(0,0,0,0)}else{if(f.startsWith("after")){this._beg=new zk.fmt.Calendar(null,this._localizedSymbols).parseDate(f.substring(5),"yyyyMMdd");this._beg.setHours(0,0,0,0)}}}},name:function(){if(this.efield){this.efield.name=this._name}}},redraw:function(){zul.db.Renderer.beforeRedraw(this);this.$supers("redraw",arguments)},onChange:function(d){this._updFormData(d.data.value)},doKeyDown_:function(d){var f=d.keyCode,e=f==37?-1:f==39?1:f==38?-7:f==40?7:0;if(e){this._shift(e)}else{this.$supers("doKeyDown_",arguments)}},_shift:function(f,e){var h=this.getTime();switch(this._view){case"month":case"year":if(f==7){f=4}else{if(f==-7){f=-4}}break;case"decade":if(f==7){f=4}else{if(f==-7){f=-4}}f*=10;var g=h.getFullYear();if(g+f<1900||g+f>2100){return}}this._shiftDate(this._view,f);var d=this.getTime();switch(this._view){case"day":if(h.getYear()==d.getYear()&&h.getMonth()==d.getMonth()){this._markCal(e)}else{this.rerender()}break;case"month":if(h.getYear()==d.getYear()){this._markCal(e)}else{this.rerender()}break;default:this.rerender()}},getFormat:function(){return this._fmt||"yyyy/MM/dd"},getZclass:function(){var d=this._zclass;return d!=null?d:"z-calendar"},_updFormData:function(d){d=new zk.fmt.Calendar().formatDate(d,this.getFormat(),this._localizedSymbols);if(this._name){d=d||"";if(!this.efield){this.efield=jq.newHidden(this._name,d,this.$n())}else{this.efield.value=d}}},focus_:function(e){if(this._view!="decade"){this._markCal({timeout:e})}else{var d;if(d=this.$n("a")){a(d,true)}}return true},bind_:function(){this.$supers(b,"bind_",arguments);var g=this.$n(),i=this.$n("title"),e=this.$n("mid"),d=this.$n("tdl"),f=this.$n("tdr"),h=this.getZclass();jq(i).hover(function(){jq(this).toggleClass(h+"-title-over")},function(){jq(this).toggleClass(h+"-title-over")});if(this._view!="decade"){this._markCal({silent:true})}this.domListen_(i,"onClick","_changeView").domListen_(e,"onClick","_clickDate").domListen_(d,"onClick","_clickArrow").domListen_(d,"onMouseOver","_doMouseEffect").domListen_(d,"onMouseOut","_doMouseEffect").domListen_(f,"onClick","_clickArrow").domListen_(f,"onMouseOver","_doMouseEffect").domListen_(f,"onMouseOut","_doMouseEffect").domListen_(e,"onMouseOver","_doMouseEffect").domListen_(e,"onMouseOut","_doMouseEffect").domListen_(g,"onMousewheel");this._updFormData(this.getTime())},unbind_:function(){var g=this.$n(),h=this.$n("title"),e=this.$n("mid"),d=this.$n("tdl"),f=this.$n("tdr");this.domUnlisten_(h,"onClick","_changeView").domUnlisten_(e,"onClick","_clickDate").domUnlisten_(d,"onClick","_clickArrow").domUnlisten_(d,"onMouseOver","_doMouseEffect").domUnlisten_(d,"onMouseOut","_doMouseEffect").domUnlisten_(f,"onClick","_clickArrow").domUnlisten_(f,"onMouseOver","_doMouseEffect").domUnlisten_(f,"onMouseOut","_doMouseEffect").domUnlisten_(e,"onMouseOver","_doMouseEffect").domUnlisten_(e,"onMouseOut","_doMouseEffect").domUnlisten_(g,"onMousewheel").$supers(b,"unbind_",arguments);this.efield=null},rerender:function(){if(this.desktop){var g=this.$n().style,e=g.width,f=g.height,d=this.$supers("rerender",arguments);g=this.$n().style;g.width=e;g.height=f;return d}},_clickArrow:function(d){var e=d.domTarget.id.indexOf("-ly")>0?this.$n("tdl"):d.domTarget.id.indexOf("-ry")>0?this.$n("tdr"):d.domTarget;if(jq(e).hasClass(this.getZclass()+"-icon-disd")){return}this._shiftView(e.id.indexOf("-tdl")>0?-1:1)},_shiftView:function(d){switch(this._view){case"day":this._shiftDate("month",d);break;case"month":this._shiftDate("year",d);break;case"year":this._shiftDate("year",d*10);break;case"decade":this._shiftDate("year",d*100)}this.rerender()},_doMousewheel:function(d,e){if(jq(this.$n(-e>0?"tdr":"tdl")).hasClass(this.getZclass()+"-icon-disd")){return}this._shiftView(e>0?-1:1);d.stop()},_doMouseEffect:function(d){var f=this.$n("ly"),g=this.$n("ry"),e=d.domTarget==f?jq(this.$n("tdl")):d.domTarget==g?jq(this.$n("tdr")):jq(d.domTarget),h=this.getZclass();if(e.hasClass(h+"-disd")){return}if(e.is("."+h+"-seld")){e.removeClass(h+"-over").toggleClass(h+"-over-seld")}else{e.toggleClass(h+"-over")}},getTime:function(){return this._value||zUtl.today(this.getFormat())},_setTime:function(k,e,h,l,f){var n=this.getTime(),i=k!=null?k:n.getFullYear(),g=e!=null?e:n.getMonth(),j=h!=null?h:n.getDate();this._value=c(i,g,j,h==null);this.fire("onChange",{value:this._value})},_clickDate:function(d){var h=d.domTarget,i;for(;h;h=h.parentNode){try{if((i=jq(h).attr("_dt"))!==undefined){i=zk.parseInt(i);break}}catch(g){continue}}this._chooseDate(h,i);var f;if(f=this.$n("a")){a(f,true)}d.stop()},_chooseDate:function(g,h){if(g&&!jq(g).hasClass(this.getZclass()+"-disd")){var d=g,e=this.getTime();switch(this._view){case"day":var i=this.getTime();this._setTime(null,d._monofs!=null&&d._monofs!=0?e.getMonth()+d._monofs:null,h);var f=this.getTime();if(i.getYear()==f.getYear()&&i.getMonth()==f.getMonth()){this._markCal()}else{this.rerender()}break;case"month":this._setTime(null,h);this._setView("day");break;case"year":this._setTime(h);this._setView("month");break;case"decade":this._setTime(h);this._setView("year")}}},_shiftDate:function(e,h){var g=this.getTime(),f=g.getFullYear(),j=g.getMonth(),d=g.getDate(),i;switch(e){case"day":d+=h;i=true;break;case"month":j+=h;break;case"year":f+=h;break;case"decade":f+=h}this._value=c(f,j,d,!i);this.fire("onChange",{value:this._value,shallClose:false})},_changeView:function(f){var e=this.$n("tm"),d=this.$n("ty"),g=this.$n("tyd"),h=this.$n("title");if(f.domTarget==e){this._setView("month")}else{if(f.domTarget==d){this._setView("year")}else{if(f.domTarget==g){this._setView("decade")}else{if(e!=null&&f.domTarget==h){this._setView("month")}}}}f.stop()},_setView:function(d){if(d!=this._view){this._view=d;this.rerender()}},_markCal:function(p){var g=this.getZclass(),D=this.getTime(),t=D.getMonth(),n=D.getFullYear();if(this._view=="day"){var A=D.getDate(),o=new Date(n,t,1).getDay()-zk.DOW_1ST,l=new Date(n,t+1,0).getDate(),r=new Date(n,t,0).getDate(),z=zUtl.today();if(o<0){o+=7}for(var x=0,f=-o+1;x<6;++x){var u=this.$n("w"+x);if(u!=null){for(var w=0;w<7;++w,++f){o=f<=0?r+f:f<=l?f:f-l;if(w==0&&f>l){u.style.display="none"}else{if(w==0){u.style.display=""}var h=jq(u.cells[w]),B=f<=0?-1:f<=l?0:1,q=f==A;h[0]._monofs=B;h.css("textDecoration","").removeClass(g+"-seld");if(q){h.addClass(g+"-seld");if(h.hasClass(g+"-over")){h.addClass(g+"-over-seld")}}else{h.removeClass(g+"-seld")}h[B?"addClass":"removeClass"]("z-outside")[zul.db.Renderer.disabled(this,n,t+B,o,z)?"addClass":"removeClass"](g+"-disd").html(zul.db.Renderer.cellHTML(this,n,t+B,o,B)).attr("_dt",o)}}}}}else{var C=this._view=="month",e=C?"m":"y",i=C?t:n%10+1,s;for(var x=0;x<12;++x){if(s=this.$n(e+x)){jq(s)[i==x?"addClass":"removeClass"](g+"-seld")}}}var E;if((E=this.$n("a"))&&(!p||!p.silent)){a(E,p&&p.timeout)}}})})();