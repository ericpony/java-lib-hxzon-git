zul.inp.Errorbox=zk.$extends(zul.wgt.Popup,{$init:function(){this.$supers("$init",arguments);this.setWidth("260px");this.setSclass("z-errbox")},show:function(b,d){this.parent=b;this.parent.__ebox=this;this.msg=d;jq(document.body).append(this);var c=this,a=b._cst&&b._cst._pos;setTimeout(function(){if(c.parent){c.open(b,null,a||"end_before",{dodgeRef:!a})}},0);zWatch.listen({onHide:[this.parent,this.onParentHide]})},destroy:function(){if(this.parent){zWatch.unlisten({onHide:[this.parent,this.onParentHide]});delete this.parent.__ebox}this.close();this.unbind();jq(this).remove();this.parent=null},onParentHide:function(){if(this.__ebox){this.__ebox.setFloating_(false);this.__ebox.close()}},bind_:function(){this.$supers(zul.inp.Errorbox,"bind_",arguments);var a=zul.inp.Errorbox;this._drag=new zk.Draggable(this,null,{starteffect:zk.$void,endeffect:a._enddrag,ignoredrag:a._ignoredrag,change:a._change});zWatch.listen({onScroll:this})},unbind_:function(){this._drag.destroy();zWatch.unlisten({onScroll:this});if(this.parent){zWatch.unlisten({onHide:[this.parent,this.onParentHide]})}this.$supers(zul.inp.Errorbox,"unbind_",arguments);this._drag=null},onScroll:function(a){if(a){this.position(this.parent,null,"end_before",{overflow:true});this._fixarrow()}},setDomVisible_:function(b,c){this.$supers("setDomVisible_",arguments);var a=this._stackup;if(a){a.style.display=c?"":"none"}},doMouseMove_:function(a){var d=a.domTarget;if(d==this.$n("c")){var e=a.pageY,c=jq(d),b=zk.parseInt(c.css("padding-right"));offs=c.zk.revisedOffset();c[e>=offs[1]&&e<offs[1]+b?"addClass":"removeClass"]("z-errbox-close-over")}else{this.$supers("doMouseMove_",arguments)}},doMouseOut_:function(a){var b=a.domTarget;if(b==this.$n("c")){jq(b).removeClass("z-errbox-close-over")}else{this.$supers("doMouseOut_",arguments)}},doClick_:function(a){var b=a.domTarget;if(b==this.$n("c")){if((b=this.parent)&&b.clearErrorMessage){b.clearErrorMessage(true,true);b.focus(0)}else{zAu.wrongValue_(b,false)}}else{this.$supers("doClick_",arguments);this.parent.focus(0)}},open:function(){this.$supers("open",arguments);this.setTopmost();this._fixarrow()},prologHTML_:function(a){var b=this.uuid;a.push('<div id="',b);a.push('-a" class="z-errbox-left z-arrow" title="');a.push(zUtl.encodeXML(msgzk.GOTO_ERROR_FIELD));a.push('"><div id="',b,'-c" class="z-errbox-right z-errbox-close"><div class="z-errbox-center">');a.push(zUtl.encodeXML(this.msg,{multiline:true}));a.push("</div></div></div>")},onFloatUp:function(a){var d=a.origin;if(d==this){this.setTopmost();return}if(!d||d==this.parent||!this.isVisible()){return}var c=this,b=d;while((c=c.parent)&&!c.isFloating_()){if(c==d){return}}for(;b&&!b.isFloating_();b=b.parent){}if(c==b){var e=d.$n();if(e){this._uncover(e)}}},_uncover:function(a){var h=zk(a).cmOffset(),e=this.$n(),c=zk(e).cmOffset();if(jq.isOverlapped(h,[a.offsetWidth,a.offsetHeight],c,[e.offsetWidth,e.offsetHeight])){var j=this.parent.$n(),i;var g=zk(j).cmOffset(),d=j.offsetHeight,b=g[1]+d;i=h[1]+a.offsetHeight<=b?b:g[1]-e.offsetHeight;var f=zk(e).toStyleOffset(0,i);e.style.top=f[1]+"px";this._fixarrow()}},_fixarrow:function(){var e=this.parent.$n(),f=this.$n(),g=this.$n("a"),b=zk(e).revisedOffset(),h=zk(f).revisedOffset();var c=h[0]-b[0],a=h[1]-b[1],d;if(c>=e.offsetWidth-2){d=a<-10?"ld":a>=e.offsetHeight-2?"lu":"l"}else{if(c<0){d=a<-10?"rd":a>=e.offsetHeight-2?"ru":"r"}else{d=a<0?"d":"u"}}g.className="z-errbox-left z-arrow-"+d}},{_enddrag:function(b){var a=b.control;a.setTopmost();a._fixarrow()},_ignoredrag:function(b,d,a){var e=b.control.$n("c");return a.domTarget==e&&jq(e).hasClass("z-errbox-close-over")},_change:function(d){var c=d.control,a=c._stackup;if(a){var b=c.$n();a.style.top=b.style.top;a.style.left=b.style.left}c._fixarrow()}});