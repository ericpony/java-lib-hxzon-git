(function(){function a(h){var e=h.$n("btn");e.title=h._curpos;h.updateFormData(h._curpos);var g=h.isVertical(),f=zk(h.getRealNode()).cmOffset(),d=g?h._getHeight():h._getWidth(),c=d>0?Math.round((h._curpos*d)/h._maxpos):0;f=zk(e).toStyleOffset(f[0],f[1]);f=g?[0,(f[1]+c)]:[(f[0]+c),0];f=h._snap(f[0],f[1]);return f[(g?1:0)]}function b(g,f){var e=jq(g.$n("btn")),c=g.isVertical()?["top","height"]:["left","width"],d={};d[c[0]]=jq.px0(f?(f+zk.parseInt(e.css(c[0]))-e[c[1]]()/2):a(g));return d}zul.inp.Slider=zk.$extends(zul.Widget,{_orient:"horizontal",_height:"207px",_width:"207px",_curpos:0,_maxpos:100,_pageIncrement:10,_slidingtext:"{0}",_pageIncrement:-1,$define:{orient:function(){this.rerender()},curpos:function(){if(this.desktop){this._fixPos()}},maxpos:function(){if(this._curpos>this._maxpos){this._curpos=this._maxpos;if(this.desktop){this._fixPos()}}},slidingtext:null,pageIncrement:null,name:function(){if(this.efield){this.efield.name=this._name}}},getZclass:function(){if(this._zclass!=null){return this._zclass}var c="z-slider";if(this.inScaleMold()){return c+"-scale"}else{if(this.inSphereMold()){return c+("horizontal"==this._orient?"-sphere-hor":"-sphere-ver")}else{return c+("horizontal"==this._orient?"-hor":"-ver")}}},doMouseOver_:function(c){jq(this.$n("btn")).addClass(this.getZclass()+"-btn-over");this.$supers("doMouseOver_",arguments)},doMouseOut_:function(c){jq(this.$n("btn")).removeClass(this.getZclass()+"-btn-over");this.$supers("doMouseOut_",arguments)},onup_:function(c){var d=zul.inp.Slider.down_btn,e;if(d){e=zk.Widget.$(d);var f=e.getZclass();jq(d).removeClass(f+"-btn-drag").removeClass(f+"-btn-over")}zul.inp.Slider.down_btn=null;if(e){jq(document).unbind("zmouseup",e.onup_)}},doMouseDown_:function(c){var d=this.$n("btn");jq(d).addClass(this.getZclass()+"-btn-drag");jq(document).bind("zmouseup",this.onup_);zul.inp.Slider.down_btn=d;this.$supers("doMouseDown_",arguments)},doClick_:function(d){var f=jq(this.$n("btn")),j=f.zk.revisedOffset(),i=this,e=this._pageIncrement,c=e<0,h=this.isVertical(),g=h?d.pageY-j[1]:d.pageX-j[0];if(!f[0]||f.is(":animated")){return}if(!c){this._curpos+=g>0?e:-e;g=null}f.animate(b(this,g),"slow",function(){j=c?i._realpos():i._curpos;if(j>i._maxpos){j=i._maxpos}i.fire("onScroll",j);if(c){i._fixPos()}});this.$supers("doClick_",arguments)},_makeDraggable:function(){this._drag=new zk.Draggable(this,this.$n("btn"),{constraint:this._orient||"horizontal",starteffect:this._startDrag,change:this._dragging,endeffect:this._endDrag})},_snap:function(d,g){var e=this.$n("btn"),f=zk(this.$n()).cmOffset();f=zk(e).toStyleOffset(f[0],f[1]);if(d<=f[0]){d=f[0]}else{var c=f[0]+this._getWidth();if(d>c){d=c}}if(g<=f[1]){g=f[1]}else{var c=f[1]+this._getHeight();if(g>c){g=c}}return[d,g]},_startDrag:function(d){var c=d.control;c.$n("btn").title="";c.slidepos=c._curpos;jq(document.body).append('<div id="zul_slidetip" class="z-slider-pp"style="position:absolute;display:none;z-index:60000;background-color:white;border: 1px outset">'+c.slidepos+"</div>");c.slidetip=jq("#zul_slidetip")[0];if(c.slidetip){c.slidetip.style.display="block";zk(c.slidetip).position(c.$n(),c.isVertical()?"end_before":"after_start")}},_dragging:function(d){var c=d.control,e=c._realpos();if(e!=c.slidepos){if(e>c._maxpos){e=c._maxpos}c.slidepos=e;if(c.slidetip){c.slidetip.innerHTML=c._slidingtext.replace(/\{0\}/g,e)}c.fire("onScrolling",e)}c._fixPos()},_endDrag:function(d){var c=d.control,e=c._realpos();c.fire("onScroll",e);c._fixPos();jq(c.slidetip).remove();c.slidetip=null},_realpos:function(h){var c=zk(this.$n("btn")).cmOffset(),g=zk(this.getRealNode()).cmOffset(),e=this._maxpos,i;if(this.isVertical()){var d=this._getHeight();i=d?Math.round(((c[1]-g[1])*e)/d):0}else{var f=this._getWidth();i=f?Math.round(((c[0]-g[0])*e)/f):0}return this._curpos=(i>=0?i:0)},_getWidth:function(){return this.getRealNode().clientWidth-this.$n("btn").offsetWidth+7},_getHeight:function(){return this.getRealNode().clientHeight-this.$n("btn").offsetHeight+7},_fixHgh:function(){if(this.isVertical()){this.$n("btn").style.top="0px";var c=this.$n("inner"),d=this.getRealNode().clientHeight;if(d>0){c.style.height=(d+7)+"px"}else{c.style.height="214px"}}},_fixPos:function(){this.$n("btn").style[this.isVertical()?"top":"left"]=jq.px0(a(this))},onSize:function(){this._fixHgh();this._fixPos()},inScaleMold:function(){return this.getMold()=="scale"},inSphereMold:function(){return this.getMold()=="sphere"},isVertical:function(){return"vertical"==this._orient},updateFormData:function(c){if(this._name){c=c||0;if(!this.efield){this.efield=jq.newHidden(this._name,c,this.$n())}else{this.efield.value=c}}},getRealNode:function(){return this.inScaleMold()&&this.isVertical()?this.$n("real"):this.$n()},bind_:function(){this.$supers(zul.inp.Slider,"bind_",arguments);this._fixHgh();this._makeDraggable();zWatch.listen({onSize:this});this.updateFormData(this._curpos);this._fixPos()},unbind_:function(){this.efield=null;if(this._drag){this._drag.destroy();this._drag=null}zWatch.unlisten({onSize:this});this.$supers(zul.inp.Slider,"unbind_",arguments)}})})();